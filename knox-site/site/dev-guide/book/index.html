
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Apache Knox Gateway">
      
      
      
        <link rel="canonical" href="https://knox.apache.org/dev-guide/book/">
      
      
        <link rel="prev" href="../../service_yarn/">
      
      
        <link rel="next" href="../admin-ui/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Overview - Apache Knox</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#apache-knox-gateway-21x-developers-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Apache Knox" class="md-header__button md-logo" aria-label="Apache Knox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apache Knox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quick_start/" class="md-tabs__link">
        
  
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../book/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../config/" class="md-tabs__link">
          
  
  
    
  
  Configuration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../service_config/" class="md-tabs__link">
          
  
  
    
  
  Services

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../knox_cli/" class="md-tabs__link">
          
  
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sse-support/" class="md-tabs__link">
          
  
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Apache Knox" class="md-nav__button md-logo" aria-label="Apache Knox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Apache Knox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_gateway-details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_client-details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_service-details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_ui_service_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Service Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_knox-samples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox Samples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_topology_port_mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Topology Port Mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Limitations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_authn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_kerberos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_ldap_authc_cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LDAP Authentication Cache
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_ldap_group_lookup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LDAP Group Lookup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_advanced_ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced LDAP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_pam_authn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PAM Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_knox_sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox SSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_knox_token/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox Token
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_preauth_sso_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-auth SSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_sso_cookie_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSO Cookie
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_tls_client_certificate_authentication_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TLS Client Certificate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_pac4j_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PAC4J
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_hadoop_auth_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hadoop Auth
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_authz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_id_assertion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity Assertion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_ha/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    High Availability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_knoxauth_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox Auth Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_mutual_authentication_ssl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mutual Auth SSL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_webappsec_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web App Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Audit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_sandbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sandbox
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_default_ha/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Default HA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_ssl_certificate_trust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSL Certificate Trust
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_avatica/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Avatica
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_cloudera_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloudera Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_elasticsearch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elasticsearch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_hbase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HBase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_hive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_livy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Livy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_oozie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Oozie
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_service_test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_solr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_storm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_webhcat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebHCat
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_webhdfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebHDFS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service_yarn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YARN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Project Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Development Processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Behavior
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway-servlet-gateway-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway Servlet &amp; Gateway Filter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-logistics" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Logistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Logistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-loaders" class="md-nav__link">
    <span class="md-ellipsis">
      Service Loaders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-path" class="md-nav__link">
    <span class="md-ellipsis">
      Class Path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maven-module" class="md-nav__link">
    <span class="md-ellipsis">
      Maven Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-contribution-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Service Contribution Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-files" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Definition Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicexml" class="md-nav__link">
    <span class="md-ellipsis">
      service.xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurabledispatch" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurableDispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewritexml" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite.xml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-runtime-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Runtime Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-dispatch-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Dispatch Dependency Injection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      Service Discovery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-url-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Service URL Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service URL Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-details" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      External Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-configuration-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Component Configuration Mapping
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Configuration Mapping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-details_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      External Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    <span class="md-ellipsis">
      Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      Providers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-context" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gateway-services" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-providers" class="md-nav__link">
    <span class="md-ellipsis">
      Standard Providers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standard Providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rewrite-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rewrite Provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rewrite-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity-assertion-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Identity Assertion Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jersey-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Jersey Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knoxsso-integration" class="md-nav__link">
    <span class="md-ellipsis">
      KnoxSSO Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-monitoring-api" class="md-nav__link">
    <span class="md-ellipsis">
      Health Monitoring API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Auditing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internationalization" class="md-nav__link">
    <span class="md-ellipsis">
      Internationalization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Admin UI
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin UI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knox_monitoring_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knoxsso_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KnoxSSO Integration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../knox_cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../knoxshell-guide/knoxshell_user_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knox Shell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin_ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin UI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../webshell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Shell
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sse-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSE Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../websocket-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebSocket Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../x-forwarded-headers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X-Forwarded Headers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Project Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Development Processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Behavior
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway-servlet-gateway-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway Servlet &amp; Gateway Filter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-logistics" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Logistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Logistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-loaders" class="md-nav__link">
    <span class="md-ellipsis">
      Service Loaders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-path" class="md-nav__link">
    <span class="md-ellipsis">
      Class Path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maven-module" class="md-nav__link">
    <span class="md-ellipsis">
      Maven Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-contribution-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Service Contribution Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-files" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Definition Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicexml" class="md-nav__link">
    <span class="md-ellipsis">
      service.xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurabledispatch" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurableDispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewritexml" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite.xml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-definition-runtime-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Service Definition Runtime Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-dispatch-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Dispatch Dependency Injection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      Service Discovery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-url-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Service URL Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service URL Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-details" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      External Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-configuration-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Component Configuration Mapping
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Configuration Mapping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-details_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      External Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    <span class="md-ellipsis">
      Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      Providers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-context" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gateway-services" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-providers" class="md-nav__link">
    <span class="md-ellipsis">
      Standard Providers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standard Providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rewrite-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rewrite Provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rewrite-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Rewrite Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity-assertion-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Identity Assertion Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jersey-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Jersey Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knoxsso-integration" class="md-nav__link">
    <span class="md-ellipsis">
      KnoxSSO Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-monitoring-api" class="md-nav__link">
    <span class="md-ellipsis">
      Health Monitoring API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Auditing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internationalization" class="md-nav__link">
    <span class="md-ellipsis">
      Internationalization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Admin UI
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       https://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->

<p><img src="../../static/images/knox-logo.gif" alt="Knox"/>
<img src="../../static/images/apache-logo.gif" align="right" alt="Apache"/></p>
<h1 id="apache-knox-gateway-21x-developers-guide">Apache Knox Gateway 2.1.x Developer's Guide<a class="headerlink" href="#apache-knox-gateway-21x-developers-guide" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Apache Knox gateway is a specialized reverse proxy gateway for various Hadoop REST APIs.
However, the gateway is built entirely upon a fairly generic framework.
This framework is used to "plug-in" all of the behavior that makes it specific to Hadoop in general and any particular Hadoop REST API.
It would be equally as possible to create a customized reverse proxy for other non-Hadoop HTTP endpoints.
This approach is taken to ensure that the Apache Knox gateway can scale with the rapidly evolving Hadoop ecosystem.</p>
<p>Throughout this guide we will be using a publicly available REST API to demonstrate the development of various extension mechanisms.
http://openweathermap.org/</p>
<h3 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h3>
<p>The gateway itself is a layer over an embedded Jetty JEE server.
At the very highest level the gateway processes requests by using request URLs to lookup specific JEE Servlet Filter chain that is used to process the request.
The gateway framework provides extensible mechanisms to assemble chains of custom filters that support secured access to services.</p>
<p>The gateway has two primary extensibility mechanisms: Service and Provider.
The Service extensibility framework provides a way to add support for new HTTP/REST endpoints.
For example, the support for WebHdfs is plugged into the Knox gateway as a Service.
The Provider extensibility framework allows adding new features to the gateway that can be used across Services.
An example of a Provider is an authentication provider.
Providers can also expose APIs that other service and provider extensions can utilize.</p>
<p>Service and Provider integrations interact with the gateway framework in two distinct phases: Deployment and Runtime.
The gateway framework can be thought of as a layer over the JEE Servlet framework.
Specifically all runtime processing within the gateway is performed by JEE Servlet Filters.
The two phases interact with this JEE Servlet Filter based model in very different ways.
The first phase, Deployment, is responsible for converting fairly simple to understand configuration called topology into JEE WebArchive (WAR) based implementation details.
The second phase, Runtime, is the processing of requests via a set of Filters configured in the WAR.</p>
<p>From an "ethos" perspective, Service and Provider extensions should attempt to incur complexity associated with configuration in the deployment phase.
This should allow for very streamlined request processing that is very high performance and easily testable.
The preference at runtime, in OO style, is for small classes that perform a specific function.
The ideal set of implementation classes are then assembled by the Service and Provider plugins during deployment.</p>
<p>A second critical design consideration is streaming.
The processing infrastructure is build around JEE Servlet Filters as they provide a natural streaming interception model.
All Provider implementations should make every attempt to maintaining this streaming characteristic.</p>
<h3 id="project-overview">Project Overview<a class="headerlink" href="#project-overview" title="Permanent link">&para;</a></h3>
<p>The table below describes the purpose of the current modules in the project.
Of particular importance are the root pom.xml and the gateway-release module.
The root pom.xml is critical because this is where all dependency version must be declared.
There should be no dependency version information in module pom.xml files.
The gateway-release module is critical because the dependencies declared there essentially define the classpath of the released gateway server.
This is also true of the other -release modules in the project.</p>
<table>
<thead>
<tr>
<th>File/Module</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LICENSE</td>
<td>The license for all source files in the release.</td>
</tr>
<tr>
<td>NOTICE</td>
<td>Attributions required by dependencies.</td>
</tr>
<tr>
<td>README</td>
<td>A brief overview of the Knox project.</td>
</tr>
<tr>
<td>CHANGES</td>
<td>A description of the changes for each release.</td>
</tr>
<tr>
<td>ISSUES</td>
<td>The knox issues for the current release.</td>
</tr>
<tr>
<td>gateway-util-common</td>
<td>Common low level utilities used by many modules.</td>
</tr>
<tr>
<td>gateway-util-launcher</td>
<td>The launcher framework.</td>
</tr>
<tr>
<td>gateway-util-urltemplate</td>
<td>The i18n logging and resource framework.</td>
</tr>
<tr>
<td>gateway-i18n</td>
<td>The URL template and rewrite utilities</td>
</tr>
<tr>
<td>gateway-i18n-logging-log4j</td>
<td>The integration of i18n logging with log4j.</td>
</tr>
<tr>
<td>gateway-i18n-logging-sl4j</td>
<td>The integration of i18n logging with sl4j.</td>
</tr>
<tr>
<td>gateway-spi</td>
<td>The SPI for service and provider extensions.</td>
</tr>
<tr>
<td>gateway-provider-identity-assertion-common</td>
<td>The identity assertion provider base</td>
</tr>
<tr>
<td>gateway-provider-identity-assertion-concat</td>
<td>An identity assertion provider that facilitates prefix and suffix concatenation.</td>
</tr>
<tr>
<td>gateway-provider-identity-assertion-pseudo</td>
<td>The default identity assertion provider.</td>
</tr>
<tr>
<td>gateway-provider-jersey</td>
<td>The jersey display provider.</td>
</tr>
<tr>
<td>gateway-provider-rewrite</td>
<td>The URL rewrite provider.</td>
</tr>
<tr>
<td>gateway-provider-rewrite-func-hostmap-static</td>
<td>Host mapping function extension to rewrite.</td>
</tr>
<tr>
<td>gateway-provider-rewrite-func-service-registry</td>
<td>Service registry function extension to rewrite.</td>
</tr>
<tr>
<td>gateway-provider-rewrite-step-secure-query</td>
<td>Crypto step extension to rewrite.</td>
</tr>
<tr>
<td>gateway-provider-security-authz-acls</td>
<td>Service level authorization.</td>
</tr>
<tr>
<td>gateway-provider-security-jwt</td>
<td>JSON Web Token utilities.</td>
</tr>
<tr>
<td>gateway-provider-security-preauth</td>
<td>Preauthenticated SSO header support.</td>
</tr>
<tr>
<td>gateway-provider-security-shiro</td>
<td>Shiro authentiation integration.</td>
</tr>
<tr>
<td>gateway-provider-security-webappsec</td>
<td>Filters to prevent common webapp security issues.</td>
</tr>
<tr>
<td>gateway-service-as</td>
<td>The implementation of the Access service POC.</td>
</tr>
<tr>
<td>gateway-service-definitions</td>
<td>The implementation of the Service definition and rewrite files.</td>
</tr>
<tr>
<td>gateway-service-hbase</td>
<td>The implementation of the HBase service.</td>
</tr>
<tr>
<td>gateway-service-hive</td>
<td>The implementation of the Hive service.</td>
</tr>
<tr>
<td>gateway-service-oozie</td>
<td>The implementation of the Oozie service.</td>
</tr>
<tr>
<td>gateway-service-tgs</td>
<td>The implementation of the Ticket Granting service POC.</td>
</tr>
<tr>
<td>gateway-service-webhdfs</td>
<td>The implementation of the WebHdfs service.</td>
</tr>
<tr>
<td>gateway-discovery-ambari</td>
<td>The Ambari service URL discovery implementation.</td>
</tr>
<tr>
<td>gateway-service-remoteconfig</td>
<td>The implementation of the RemoteConfigurationRegistryClientService.</td>
</tr>
<tr>
<td>gateway-server</td>
<td>The implementation of the Knox gateway server.</td>
</tr>
<tr>
<td>gateway-shell</td>
<td>The implementation of the Knox Groovy shell.</td>
</tr>
<tr>
<td>gateway-test-ldap</td>
<td>Pulls in all of the dependencies of the test LDAP server.</td>
</tr>
<tr>
<td>gateway-server-launcher</td>
<td>The launcher definition for the gateway.</td>
</tr>
<tr>
<td>gateway-shell-launcher</td>
<td>The launcher definition for the shell.</td>
</tr>
<tr>
<td>knox-cli-launcher</td>
<td>A module to pull in all of the dependencies of the CLI.</td>
</tr>
<tr>
<td>gateway-test-ldap-launcher</td>
<td>The launcher definition for the test LDAP server.</td>
</tr>
<tr>
<td>gateway-release</td>
<td>The definition of the gateway binary release. Contains content and dependencies to be included in binary gateway package.</td>
</tr>
<tr>
<td>gateway-test-utils</td>
<td>Various utilities used in unit and system tests.</td>
</tr>
<tr>
<td>gateway-test</td>
<td>The functional tests.</td>
</tr>
<tr>
<td>pom.xml</td>
<td>The top level pom.</td>
</tr>
<tr>
<td>build.xml</td>
<td>A collection of utility for building and releasing.</td>
</tr>
</tbody>
</table>
<h3 id="development-processes">Development Processes<a class="headerlink" href="#development-processes" title="Permanent link">&para;</a></h3>
<p>The project uses Maven in general with a few convenience Ant targets.</p>
<p>Building the project can be built via Maven or Ant.  The two commands below are equivalent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>mvn clean install
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>ant
</code></pre></div>
<p>A more complete build can be done that builds and generates the unsigned ZIP release artifacts.
You will find these in the target/{version} directory (e.g. target/0.XX.0-SNAPSHOT).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>mvn -Ppackage clean install
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>ant release
</code></pre></div>
<p>There are a few other Ant targets that are especially convenient for testing.</p>
<p>This command installs the gateway into the {{{install}}} directory of the project.
Note that this command does not first build the project.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ant install-test-home
</code></pre></div>
<p>This command starts the gateway and LDAP servers installed by the command above into a test GATEWAY_HOME (i.e. install).
Note that this command does not first install the test home.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ant start-test-servers
</code></pre></div>
<p>So putting things together the following Ant command will build a release, install it and start the servers ready for manual testing.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ant release install-test-home start-test-servers
</code></pre></div>
<h3 id="docker-image">Docker Image<a class="headerlink" href="#docker-image" title="Permanent link">&para;</a></h3>
<p>Apache Knox ships with a <code>docker</code> Maven module that will build a Docker image. To build the Knox Docker image, you must have Docker running on your machine. The following Maven command will build Knox and package it into a Docker image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>mvn -Ppackage,release,docker clean package
</code></pre></div>
<p>This will build 2 Docker images:</p>
<ul>
<li><code>apache/knox:gateway-2.1.0-SNAPSHOT</code></li>
<li><code>apache/knox:ldap-2.1.0-SNAPSHOT</code></li>
</ul>
<p>The <code>gateway</code> image will use an entrypoint to start Knox Gateway. The <code>ldap</code> image will use an entrypoint to start Knox Demo LDAP.</p>
<p>An example of using the Docker images would be the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>docker run -d --name knox-ldap -p 33389:33389 apache/knox:ldap-2.1.0-SNAPSHOT
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>docker run -d --name knox-gateway -p 8443:8443 apache/knox:gateway-2.1.0-SNAPSHOT
</code></pre></div>
<p>Using docker-compose that would look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>docker-compose -f gateway-docker/src/main/resources/docker-compose.yml up
</code></pre></div>
<p>The images are designed to be a base that can be built on to add your own providers, descriptors, and topologies as necessary.</p>
<h2 id="behavior">Behavior<a class="headerlink" href="#behavior" title="Permanent link">&para;</a></h2>
<p>There are two distinct phases in the behavior of the gateway.
These are the deployment and runtime phases.
The deployment phase is responsible for converting topology descriptors into an executable JEE style WAR.
The runtime phase is the processing of requests via WAR created during the deployment phase.</p>
<p>The deployment phase is arguably the more complex of the two phases.
This is because runtime relies on well known JEE constructs while deployment introduces new framework concepts.
The base concept of the deployment framework is that of a "contributor".
In the framework, contributors are pluggable component responsible for generating JEE WAR artifacts from topology files.</p>
<h3 id="deployment-behavior">Deployment Behavior<a class="headerlink" href="#deployment-behavior" title="Permanent link">&para;</a></h3>
<p>The goal of the deployment phase is to take easy to understand topology descriptions and convert them into optimized runtime artifacts.
Our goal is not only should the topology descriptors be easy to understand, but have them be easy for a management system (e.g. Ambari) to generate.
Think of deployment as compiling an assembly descriptor into a JEE WAR.
WARs are then deployed to an embedded JEE container (i.e. Jetty).</p>
<p>Consider the results of starting the gateway the first time.
There are two sets of files that are relevant for deployment.
The first is the topology file <code>&lt;GATEWAY_HOME&gt;/conf/topologies/sandbox.xml</code>.
This second set is the WAR structure created during the deployment of the topology file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>data/deployments/sandbox.war.143bfef07f0/WEB-INF
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  web.xml
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  gateway.xml
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>  shiro.ini
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  rewrite.xml
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>  hostmap.txt
</code></pre></div>
<p>Notice that the directory <code>sandbox.war.143bfef07f0</code> is an "unzipped" representation of a JEE WAR file.
This specifically means that it contains a <code>WEB-INF</code> directory which contains a <code>web.xml</code> file.
For the curious the strange number (i.e. 143bfef07f0) in the name of the WAR directory is an encoded timestamp.
This is the timestamp of the topology file (i.e. sandbox.xml) at the time the deployment occurred.
This value is used to determine when topology files have changed and redeployment is required.</p>
<p>Here is a brief overview of the purpose of each file in the WAR structure.</p>
<p>web.xml
: A standard JEE WAR descriptor.
In this case a build-in GatewayServlet is mapped to the url pattern /*.</p>
<p>gateway.xml
: The configuration file for the GatewayServlet.
Defines the filter chain that will be applied to each service's various URLs.</p>
<p>shiro.ini
: The configuration file for the Shiro authentication provider's filters.
This information is derived from the information in the provider section of the topology file.</p>
<p>rewrite.xml
: The configuration file for the rewrite provider's filter.
This captures all of the rewrite rules for the services.
These rules are contributed by the contributors for each service.</p>
<p>hostmap.txt
: The configuration file the hostmap provider's filter.
This information is derived from the information in the provider section of the topology file.</p>
<p>The deployment framework follows "visitor" style patterns.
Each topology file is parsed and the various constructs within it are "visited".
The appropriate contributor for each visited construct is selected by the framework.
The contributor is then passed the contrust from the topology file and asked to update the JEE WAR artifacts.
Each contributor is free to inspect and modify any portion of the WAR artifacts.</p>
<p>The diagram below provides an overview of the deployment processing.
Detailed descriptions of each step follow the diagram.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>@startuml
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>!include deployment-overview.puml
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>@enduml
</code></pre></div>
<ol>
<li>
<p>The gateway server loads a topology file from conf/topologies into an internal structure.</p>
</li>
<li>
<p>The gateway server delegates to a deployment factory to create the JEE WAR structure.</p>
</li>
<li>
<p>The deployment factory first creates a basic WAR structure with WEB-INF/web.xml.</p>
</li>
<li>
<p>Each provider and service in the topology is visited and the appropriate deployment contributor invoked.
Each contributor is passed the appropriate information from the topology and modifies the WAR structure.</p>
</li>
<li>
<p>A complete WAR structure is returned to the gateway service.</p>
</li>
<li>
<p>The gateway server uses internal container APIs to dynamically deploy the WAR.</p>
</li>
</ol>
<p>The Java method below is the actual code from the DeploymentFactory that implements this behavior.
You will note the initialize, contribute, finalize sequence.
Each contributor is given three opportunities to interact with the topology and archive.
This allows the various contributors to interact if required.
For example, the service contributors use the deployment descriptor added to the WAR by the rewrite provider.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WebArchive</span><span class="w"> </span><span class="nf">createDeployment</span><span class="p">(</span><span class="w"> </span><span class="n">GatewayConfig</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">Topology</span><span class="w"> </span><span class="n">topology</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProviderDeploymentContributor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">providers</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ServiceDeploymentContributor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">services</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="n">providers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectContextProviders</span><span class="p">(</span><span class="w"> </span><span class="n">topology</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectContextServices</span><span class="p">(</span><span class="w"> </span><span class="n">topology</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">  </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDeploymentContext</span><span class="p">(</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">topology</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">topology</span><span class="p">,</span><span class="w"> </span><span class="n">providers</span><span class="p">,</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="n">initialize</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">providers</span><span class="p">,</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="n">contribute</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">providers</span><span class="p">,</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="n">finalize</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">providers</span><span class="p">,</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getWebArchive</span><span class="p">();</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="p">}</span>
</code></pre></div>
<p>Below is a diagram that provides more detail.
This diagram focuses on the interactions between the deployment factory and the service deployment contributors.
Detailed description of each step follow the diagram.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>@startuml
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>!include deployment-service.puml
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>@enduml
</code></pre></div>
<ol>
<li>
<p>The gateway server loads global configuration (i.e. <GATEWAY_HOME>/conf/gateway-site.xml</p>
</li>
<li>
<p>The gateway server loads a topology descriptor file.</p>
</li>
<li>
<p>The gateway server delegates to the deployment factory to create a deployable WAR structure.</p>
</li>
<li>
<p>The deployment factory creates a runtime descriptor to configure that gateway servlet.</p>
</li>
<li>
<p>The deployment factory creates a basic WAR structure and adds the gateway servlet runtime descriptor to it.</p>
</li>
<li>
<p>The deployment factory creates a deployment context object and adds the WAR structure to it.</p>
</li>
<li>
<p>For each service defined in the topology descriptor file the appropriate service deployment contributor is selected and invoked.
The correct service deployment contributor is determined by matching the role of a service in the topology descriptor
to a value provided by the getRole() method of the ServiceDeploymentContributor interface.
The initializeContribution method from <em>each</em> service identified in the topology is called.
Each service deployment contributor is expected to setup any runtime artifacts in the WAR that other services or provides may need.</p>
</li>
<li>
<p>The contributeService method from <em>each</em> service identified in the topology is called.
This is where the service deployment contributors will modify any runtime descriptors.</p>
</li>
<li>
<p>One of they ways that a service deployment contributor can modify the runtime descriptors is by asking the framework to contribute filters.
This is how services are loosely coupled to the providers of features.
For example a service deployment contributor might ask the framework to contribute the filters required for authorization.
The deployment framework will then delegate to the correct provider deployment contributor to add filters for that feature.</p>
</li>
<li>
<p>Finally the finalizeContribution method for each service is invoked.
This provides an opportunity to react to anything done via the contributeService invocations and tie up any loose ends.</p>
</li>
<li>
<p>The populated WAR is returned to the gateway server.</p>
</li>
</ol>
<p>The following diagram will provide expanded detail on the behavior of provider deployment contributors.
Much of the beginning and end of the sequence shown overlaps with the service deployment sequence above.
Those steps (i.e. 1-6, 17) will not be described below for brevity.
The remaining steps have detailed descriptions following the diagram.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>@startuml
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>!include deployment-provider.puml
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>@enduml
</code></pre></div>
<ol>
<li>
<p>For each provider the appropriate provider deployment contributor is selected and invoked.
The correct service deployment contributor is determined by first matching the role of a provider in the topology descriptor
to a value provided by the getRole() method of the ProviderDeploymentContributor interface.
If this is ambiguous, the name from the topology is used match the value provided by the getName() method of the ProviderDeploymentContributor interface.
The initializeContribution method from <em>each</em> provider identified in the topology is called.
Each provider deployment contributor is expected to setup any runtime artifacts in the WAR that other services or provides may need.
Note: In addition, others provider not explicitly referenced in the topology may have their initializeContribution method called.
If this is the case only one default instance for each role declared vis the getRole() method will be used.
The method used to determine the default instance is non-deterministic so it is best to select a particular named instance of a provider for each role.</p>
</li>
<li>
<p>Each provider deployment contributor will typically add any runtime deployment descriptors it requires for operation.
These descriptors are added to the WAR structure within the deployment context.</p>
</li>
<li>
<p>The contributeProvider method of each configured or default provider deployment contributor is invoked.</p>
</li>
<li>
<p>Each provider deployment contributor populates any runtime deployment descriptors based on information in the topology.</p>
</li>
<li>
<p>Provider deployment contributors are never asked to contribute to the deployment directly.
Instead a service deployment contributor will ask to have a particular provider role (e.g. authentication) contribute to the deployment.</p>
</li>
<li>
<p>A service deployment contributor asks the framework to contribute filters for a given provider role.</p>
</li>
<li>
<p>The framework selects the appropriate provider deployment contributor and invokes its contributeFilter method.</p>
</li>
<li>
<p>During this invocation the provider deployment contributor populate populate service specific information.
In particular it will add filters to the gateway servlet's runtime descriptor by adding JEE Servlet Filters.
These filters will be added to the resources (or URLs) identified by the service deployment contributor.</p>
</li>
<li>
<p>The finalizeContribute method of all referenced and default provider deployment contributors is invoked.</p>
</li>
<li>
<p>The provider deployment contributor is expected to perform any final modifications to the runtime descriptors in the WAR structure.</p>
</li>
</ol>
<h3 id="runtime-behavior">Runtime Behavior<a class="headerlink" href="#runtime-behavior" title="Permanent link">&para;</a></h3>
<p>The runtime behavior of the gateway is somewhat simpler as it more or less follows well known JEE models.
There is one significant wrinkle.
The filter chains are managed within the GatewayServlet as opposed to being managed by the JEE container.
This is the result of an early decision made in the project.
The intention is to allow more powerful URL matching than is provided by the JEE Servlet mapping mechanisms.</p>
<p>The diagram below provides a high-level overview of the runtime processing.
An explanation for each step is provided after the diagram.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>@startuml
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>!include runtime-overview.puml
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>@enduml
</code></pre></div>
<ol>
<li>
<p>A REST client makes a HTTP request that is received by the embedded JEE container.</p>
</li>
<li>
<p>A filter chain is looked up in a map of URLs to filter chains.</p>
</li>
<li>
<p>The filter chain, which is itself a filter, is invoked.</p>
</li>
<li>
<p>Each filter invokes the filters that follow it in the chain.
The request and response objects can be wrapped in typically JEE Filter fashion.
Filters may not continue chain processing and return if that is appropriate.</p>
</li>
<li>
<p>Eventually the end of the last filter in the chain is invoked.
Typically this is a special "dispatch" filter that is responsible for dispatching the request to the ultimate endpoint.
Dispatch filters are also responsible for reading the response.</p>
</li>
<li>
<p>The response may be in the form of a number of content types (e.g. application/json, text/xml).</p>
</li>
<li>
<p>The response entity is streamed through the various response wrappers added by the filters.
These response wrappers may rewrite various portions of the headers and body as per their configuration.</p>
</li>
<li>
<p>The return of the response entity to the client is ultimately "pulled through" the filter response wrapper by the container.</p>
</li>
<li>
<p>The response entity is returned original client.</p>
</li>
</ol>
<p>This diagram provides a more detailed breakdown of the request processing.
Again, descriptions of each step follow the diagram.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>@startuml
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>!include runtime-request-processing.puml
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>@enduml
</code></pre></div>
<ol>
<li>
<p>A REST client makes a HTTP request that is received by the embedded JEE container.</p>
</li>
<li>
<p>The embedded container looks up the servlet mapped to the URL and invokes the service method.
This our case the GatewayServlet is mapped to /<em> and therefore receives all requests for a given topology.
Keep in mind that the WAR itself is deployed on a root context path that typically contains a level for the gateway and the name of the topology.
This means that there is a single GatewayServlet per topology and it is effectivly mapped to <gateway>/<topology>/</em>.</p>
</li>
<li>
<p>The GatewayServlet holds a single reference to a GatewayFilter which is a specialized JEE Servlet Filter.
This choice was made to allow the GatewayServlet to dynamically deploy modified topologies.
This is done by building a new GatewayFilter instance and replacing the old in an atomic fashion.</p>
</li>
<li>
<p>The GatewayFilter contains another layer of URL mapping as defined in the gateway.xml runtime descriptor.
The various service deployment contributor added these mappings at deployment time.
Each service may add a number of different sub-URLs depending in their requirements.
These sub-URLs will all be mapped to independently configured filter chains.</p>
</li>
<li>
<p>The GatewayFilter invokes the doFilter method on the selected chain.</p>
</li>
<li>
<p>The chain invokes the doFilter method of the first filter in the chain.</p>
</li>
<li>
<p>Each filter in the chain continues processing by invoking the doFilter on the next filter in the chain.
Ultimately a dispatch filter forward the request to the real service instead of invoking another filter.
This is sometimes referred to as pivoting.</p>
</li>
</ol>
<h2 id="gateway-servlet-gateway-filter">Gateway Servlet &amp; Gateway Filter<a class="headerlink" href="#gateway-servlet-gateway-filter" title="Permanent link">&para;</a></h2>
<p>TODO</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">&lt;web-app&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">&lt;servlet&gt;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">&lt;servlet-name&gt;</span>sample<span class="nt">&lt;/servlet-name&gt;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">&lt;servlet-class&gt;</span>org.apache.knox.gateway.GatewayServlet<span class="nt">&lt;/servlet-class&gt;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="nt">&lt;init-param&gt;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">      </span><span class="nt">&lt;param-name&gt;</span>gatewayDescriptorLocation<span class="nt">&lt;/param-name&gt;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">      </span><span class="nt">&lt;param-value&gt;</span>gateway.xml<span class="nt">&lt;/param-value&gt;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span><span class="nt">&lt;/init-param&gt;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="nt">&lt;/servlet&gt;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">  </span><span class="nt">&lt;servlet-mapping&gt;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="nt">&lt;servlet-name&gt;</span>sandbox<span class="nt">&lt;/servlet-name&gt;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="nt">&lt;/servlet-mapping&gt;</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">  </span><span class="nt">&lt;listener&gt;</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="nt">&lt;listener-class&gt;</span>org.apache.knox.gateway.services.GatewayServicesContextListener<span class="nt">&lt;/listener-class&gt;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="nt">&lt;/listener&gt;</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">  </span>...
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="nt">&lt;/web-app&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">&lt;gateway&gt;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">&lt;resource&gt;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="nt">&lt;role&gt;</span>WEATHER<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="nt">&lt;pattern&gt;</span>/weather/**?**<span class="nt">&lt;/pattern&gt;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">      </span><span class="nt">&lt;role&gt;</span>authentication<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">      </span><span class="nt">&lt;name&gt;</span>sample<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">      </span><span class="nt">&lt;class&gt;</span>...<span class="nt">&lt;/class&gt;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="nt">&lt;filter&gt;</span>...<span class="nt">&lt;/filter&gt;</span>*
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">  </span><span class="nt">&lt;/resource&gt;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="nt">&lt;/gateway&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nd">@Test</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testDevGuideSample</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="n">Template</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">matcher</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">.</span><span class="na">Match</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="c1">// GET http://api.openweathermap.org/data/2.5/weather?q=Palo+Alto</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">  </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;/weather/**?**&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;/weather/2.5?q=Palo+Alto&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="n">matcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">  </span><span class="n">matcher</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fake-chain&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matcher</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">  </span><span class="n">assertThat</span><span class="p">(</span><span class="w"> </span><span class="n">match</span><span class="p">.</span><span class="na">getValue</span><span class="p">(),</span><span class="w"> </span><span class="n">is</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;fake-chain&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="p">}</span>
</code></pre></div>
<h2 id="extension-logistics">Extension Logistics<a class="headerlink" href="#extension-logistics" title="Permanent link">&para;</a></h2>
<p>There are a number of extension points available in the gateway: services, providers, rewrite steps and functions, etc.
All of these use the Java ServiceLoader mechanism for their discovery.
There are two ways to make these extensions available on the class path at runtime.
The first way to add a new module to the project and have the extension "built-in".
The second is to add the extension to the class path of the server after it is installed.
Both mechanism are described in more detail below.</p>
<h3 id="service-loaders">Service Loaders<a class="headerlink" href="#service-loaders" title="Permanent link">&para;</a></h3>
<p>Extensions are discovered via Java's <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">Service Loader</a> mechanism.
There are good <a href="http://docs.oracle.com/javase/tutorial/ext/basics/spi.html">tutorials</a> available for learning more about this.
The basics come down to two things.</p>
<ol>
<li>
<p>Implement the service contract interface (e.g. ServiceDeploymentContributor, ProviderDeploymentContributor)</p>
</li>
<li>
<p>Create a file in META-INF/services of the JAR that will contain the extension.
This file will be named as the fully qualified name of the contract interface (e.g. org.apache.knox.gateway.deploy.ProviderDeploymentContributor).
The contents of the file will be the fully qualified names of any implementation of that contract interface in that JAR.</p>
</li>
</ol>
<p>One tip is to include a simple test with each of you extension to ensure that it will be properly discovered.
This is very helpful in situations where a refactoring fails to change the a class in the META-INF/services files.
An example of one such test from the project is shown below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testServiceLoader</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">ServiceLoader</span><span class="w"> </span><span class="n">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ServiceLoader</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="w"> </span><span class="n">ProviderDeploymentContributor</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="n">Iterator</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loader</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Service iterator empty.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ShiroDeploymentContributor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="n">fail</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to find &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ShiroDeploymentContributor</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; via service loader.&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<h3 id="class-path">Class Path<a class="headerlink" href="#class-path" title="Permanent link">&para;</a></h3>
<p>One way to extend the functionality of the server without having to recompile is to add the extension JARs to the servers class path.
As an extensible server this is made straight forward but it requires some understanding of how the server's classpath is setup.
In the <GATEWAY_HOME> directory there are four class path related directories (i.e. bin, lib, dep, ext).</p>
<p>The bin directory contains very small "launcher" jars that contain only enough code to read configuration and setup a class path.
By default the configuration of a launcher is embedded with the launcher JAR but it may also be extracted into a .cfg file.
In that file you will see how the class path is defined.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>class.path=../lib/*.jar,../dep/*.jar;../ext;../ext/*.jar
</code></pre></div>
<p>The paths are all relative to the directory that contains the launcher JAR.</p>
<p>../lib/*.jar
: These are the "built-in" jars that are part of the project itself.
Information is provided elsewhere in this document for how to integrate a built-in extension.</p>
<p>../dep/*.jar
: These are the JARs for all of the external dependencies of the project.
This separation between the generated JARs and dependencies help keep licensing issues straight.</p>
<p>../ext
: This directory is for post-install extensions and is empty by default.
Including the directory (vs *.jar) allows for individual classes to be placed in this directory.</p>
<p>../ext/*.jar
: This would pick up all extension JARs placed in the ext directory.</p>
<p>Note that order is significant.  The lib JARs take precedence over dep JARs and they take precedence over ext classes and JARs.</p>
<h3 id="maven-module">Maven Module<a class="headerlink" href="#maven-module" title="Permanent link">&para;</a></h3>
<p>Integrating an extension into the project follows well established Maven patterns for adding modules.
Below are several points that are somewhat unique to the Knox project.</p>
<ol>
<li>
<p>Add the module to the root pom.xml file's <modules> list.
Take care to ensure that the module is in the correct place in the list based on its dependencies.
Note: In general modules should not have non-test dependencies on gateway-server but rather gateway-spi</p>
</li>
<li>
<p>Any new dependencies must be represented in the root pom.xml file's <dependencyManagement> section.
The required version of the dependencies will be declared there.
The new sub-module's pom.xml file must not include dependency version information.
This helps prevent dependency version conflict issues.</p>
</li>
<li>
<p>If the extension is to be "built into" the released gateway server it needs to be added as a dependency to the gateway-release module.
This is done by adding to the <dependencies> section of the gateway-release's pom.xml file.
If this isn't done the JARs for the module will not be automatically packaged into the release artifacts.
This can be useful while an extension is under development but not yet ready for inclusion in the release.</p>
</li>
</ol>
<p>More detailed examples of adding both a service and a provider extension are provided in subsequent sections.</p>
<h3 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h3>
<p>Services are extensions that are responsible for converting information in the topology file to runtime descriptors.
Typically services do not require their own runtime descriptors.
Rather, they modify either the gateway runtime descriptor (i.e. gateway.xml) or descriptors of other providers (e.g. rewrite.xml).</p>
<p>The service provider interface for a Service is ServiceDeploymentContributor and is shown below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.deploy</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.topology.Service</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ServiceDeploymentContributor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">getRole</span><span class="p">();</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">initializeContribution</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeService</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">finalizeContribution</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">}</span>
</code></pre></div>
<p>Each service provides an implementation of this interface that is discovered via the ServerLoader mechanism previously described.
The meaning of this is best understood in the context of the structure of the topology file.
A fragment of a topology file is shown below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nt">&lt;topology&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="nt">&lt;gateway&gt;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">        </span>....
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="nt">&lt;/gateway&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="nt">&lt;service&gt;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">        </span><span class="nt">&lt;role&gt;</span>WEATHER<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="nt">&lt;url&gt;</span>http://api.openweathermap.org/data<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="nt">&lt;/service&gt;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span>....
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="nt">&lt;/topology&gt;</span>
</code></pre></div>
<p>With these two things a more detailed description of the purpose of each ServiceDeploymentContributor method should be helpful.</p>
<p>String getRole();
: This is the value the framework uses to associate a given <code>&lt;service&gt;&lt;role&gt;</code> with a particular ServiceDeploymentContributor implementation.
See below how the example WeatherDeploymentContributor implementation returns the role WEATHER that matches the value in the topology file.
This will result in the WeatherDeploymentContributor's methods being invoked when a WEATHER service is encountered in the topology file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WeatherDeploymentContributor</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ServiceDeploymentContributorBase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">ROLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WEATHER&quot;</span><span class="p">;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRole</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ROLE</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">}</span>
</code></pre></div>
<p>void initializeContribution( DeploymentContext context );
: In this method a contributor would create, initialize and add any descriptors it was responsible for to the deployment context.
For the weather service example this isn't required so the empty method isn't shown here.</p>
<p>void contributeService( DeploymentContext context, Service service ) throws Exception;
: In this method a service contributor typically add and configures any features it requires.
This method will be dissected in more detail below.</p>
<p>void finalizeContribution( DeploymentContext context );
: In this method a contributor would finalize any descriptors it was responsible for to the deployment context.
For the weather service example this isn't required so the empty method isn't shown here.</p>
<h4 id="service-contribution-behavior">Service Contribution Behavior<a class="headerlink" href="#service-contribution-behavior" title="Permanent link">&para;</a></h4>
<p>In order to understand the job of the ServiceDeploymentContributor a few runtime descriptors need to be introduced.</p>
<p>Gateway Runtime Descriptor: WEB-INF/gateway.xml
: This runtime descriptor controls the behavior of the GatewayFilter.
It defines a mapping between resources (i.e. URL patterns) and filter chains.
The sample gateway runtime descriptor helps illustrate.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">&lt;gateway&gt;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="nt">&lt;resource&gt;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="nt">&lt;role&gt;</span>WEATHER<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="nt">&lt;pattern&gt;</span>/weather/**?**<span class="nt">&lt;/pattern&gt;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="nt">&lt;role&gt;</span>authentication<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">      </span><span class="nt">&lt;name&gt;</span>sample<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">      </span><span class="nt">&lt;class&gt;</span>...<span class="nt">&lt;/class&gt;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="nt">&lt;filter&gt;</span>...<span class="nt">&lt;/filter&gt;</span>*
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span>...
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span><span class="nt">&lt;/resource&gt;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="nt">&lt;/gateway&gt;</span>
</code></pre></div>
<p>Rewrite Provider Runtime Descriptor: WEB-INF/rewrite.xml
: The rewrite provider runtime descriptor controls the behavior of the rewrite filter.
Each service contributor is responsible for adding the rules required to control the URL rewriting required by that service.
Later sections will provide more detail about the capabilities of the rewrite provider.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">dir=</span><span class="s">&quot;IN&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WEATHER/openweathermap/inbound/versioned/file&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">      </span><span class="na">pattern=</span><span class="s">&quot;*://*:*/**/weather/{version}?{**}&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">template=</span><span class="s">&quot;{$serviceUrl[WEATHER]}/{version}/weather?{**}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="nt">&lt;/rule&gt;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<p>With these two descriptors in mind a detailed breakdown of the WeatherDeploymentContributor's contributeService method will make more sense.
At a high level the important concept is that contributeService is invoked by the framework for each <service> in the topology file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WeatherDeploymentContributor</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ServiceDeploymentContributorBase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeService</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="n">contributeResources</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="n">contributeRewriteRules</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeResources</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">URISyntaxException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getGatewayDescriptor</span><span class="p">().</span><span class="na">addResource</span><span class="p">();</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="n">resource</span><span class="p">.</span><span class="na">role</span><span class="p">(</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getRole</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">    </span><span class="n">resource</span><span class="p">.</span><span class="na">pattern</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;/weather/**?**&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">    </span><span class="n">addAuthenticationFilter</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">    </span><span class="n">addRewriteFilter</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">    </span><span class="n">addDispatchFilter</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeRewriteRules</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">    </span><span class="n">UrlRewriteRulesDescriptor</span><span class="w"> </span><span class="n">allRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getDescriptor</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;rewrite&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">    </span><span class="n">UrlRewriteRulesDescriptor</span><span class="w"> </span><span class="n">newRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadRulesFromClassPath</span><span class="p">();</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">    </span><span class="n">allRules</span><span class="p">.</span><span class="na">addRules</span><span class="p">(</span><span class="w"> </span><span class="n">newRules</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="p">}</span>
</code></pre></div>
<p>The DeploymentContext parameter contains information about the deployment as well as the WAR structure being created via deployment.
The Service parameter is the object representation of the <service> element in the topology file.
Details about particularly important lines follow the code block.</p>
<p>ResourceDescriptor resource = context.getGatewayDescriptor().addResource();
: Obtains a reference to the gateway runtime descriptor and adds a new resource element.
Note that many of the APIs in the deployment framework follow a fluent vs bean style.</p>
<p>resource.role( service.getRole() );
: Sets the role for a particular resource.
Many of the filters may need access to this role information in order to make runtime decisions.</p>
<p>resource.pattern( "/weather/<strong>?</strong>" );
: Sets the URL pattern to which the filter chain that will follow will be mapped within the GatewayFilter.</p>
<p>add*Filter( context, service, resource );
: These are taken from a base class.
A representation of the implementation of that method from the base class is shown below.
Notice how this essentially delegates back to the framework to add the filters required by a particular provider role (e.g. "rewrite").</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addRewriteFilter</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="n">context</span><span class="p">.</span><span class="na">contributeFilter</span><span class="p">(</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rewrite&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>UrlRewriteRulesDescriptor allRules = context.getDescriptor( "rewrite" );
: Here the rewrite provider runtime descriptor is obtained by name from the deployment context.
This does represent a tight coupling in this case between this service and the default rewrite provider.
The rewrite provider however is unlikely to be related with alternate implementations.</p>
<p>UrlRewriteRulesDescriptor newRules = loadRulesFromClassPath();
: This is convenience method for loading partial rewrite descriptor information from the classpath.
Developing and maintaining these rewrite rules is far easier as an external resource.
The rewrite descriptor API could however have been used to achieve the same result.</p>
<p>allRules.addRules( newRules );
: Here the rewrite rules for the weather service are merged into the larger set of rewrite rules.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nt">&lt;project&gt;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.knox<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>gateway<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>2.1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gateway-service-weather<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>gateway-service-weather<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>A<span class="w"> </span>sample<span class="w"> </span>extension<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>gateway<span class="w"> </span>for<span class="w"> </span>a<span class="w"> </span>weather<span class="w"> </span>REST<span class="w"> </span>API.<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">    </span><span class="nt">&lt;licenses&gt;</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">        </span><span class="nt">&lt;license&gt;</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>The<span class="w"> </span>Apache<span class="w"> </span>Software<span class="w"> </span>License,<span class="w"> </span>Version<span class="w"> </span>2.0<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://www.apache.org/licenses/LICENSE-2.0.txt<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">            </span><span class="nt">&lt;distribution&gt;</span>repo<span class="nt">&lt;/distribution&gt;</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">        </span><span class="nt">&lt;/license&gt;</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">    </span><span class="nt">&lt;/licenses&gt;</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>${gateway-group}<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>gateway-spi<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>${gateway-group}<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>gateway-provider-rewrite<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="w">        </span>...<span class="w"> </span>Test<span class="w"> </span>Dependencies<span class="w"> </span>...
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div>
<h4 id="service-definition-files">Service Definition Files<a class="headerlink" href="#service-definition-files" title="Permanent link">&para;</a></h4>
<p>As of release 0.6.0, the gateway now also supports a declarative way of plugging-in a new Service. A Service can be defined with a
combination of two files, these are:</p>
<div class="highlight"><pre><span></span><code>service.xml
rewrite.xml
</code></pre></div>
<p>The rewrite.xml file contains the rewrite rules as defined in other sections of this guide, and the service.xml file contains
the various routes (paths) to be provided by the Service and the rewrite rule bindings to those paths. This will be described in further detail
in this section.</p>
<p>While the service.xml file is absolutely required, the rewrite.xml file in theory is optional (though it is highly unlikely that no rewrite rules
are needed).</p>
<p>To add a new service, simply add a service.xml and rewrite.xml file in an appropriate directory (see #[Service Definition Directory Structure])
in the module gateway-service-definitions to make the new service part of the Knox build.</p>
<h5 id="servicexml">service.xml<a class="headerlink" href="#servicexml" title="Permanent link">&para;</a></h5>
<p>Below is a sample of a very simple service.xml file, taking the same weather api example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">&lt;service</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;WEATHER&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;weather&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;0.1.0&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="nt">&lt;routes&gt;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">        </span><span class="nt">&lt;route</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/weather/**?**&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">&lt;/routes&gt;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="nt">&lt;/service&gt;</span>
</code></pre></div>
<p><strong>service</strong>
: The root tag is 'service' that has the three required attributes: <em>role</em>, <em>name</em> and <em>version</em>. These three values disambiguate this
service definition from others. To ensure the exact same service definition is being used in a topology file, all values should be specified,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">&lt;topology&gt;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="nt">&lt;gateway&gt;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">        </span>....
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="nt">&lt;/gateway&gt;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="nt">&lt;service&gt;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">        </span><span class="nt">&lt;role&gt;</span>WEATHER<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>weather<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>0.1.0<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">        </span><span class="nt">&lt;url&gt;</span>http://api.openweathermap.org/data<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">        </span><span class="nt">&lt;dispatch&gt;</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">            </span><span class="nt">&lt;contributor-name&gt;</span>custom-client<span class="nt">&lt;/contributor-name&gt;</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">            </span><span class="nt">&lt;ha-contributor-name&gt;</span>ha-client<span class="nt">&lt;/ha-contributor-name&gt;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">            </span><span class="nt">&lt;classname&gt;</span>org.apache.knox.gateway.dispatch.PassAllHeadersDispatch<span class="nt">&lt;/classname&gt;</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">            </span><span class="nt">&lt;ha-classname&gt;&lt;/ha-classname&gt;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">            </span><span class="nt">&lt;http-client-factory&gt;&lt;/http-client-factory&gt;</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">            </span><span class="nt">&lt;use-two-way-ssl&gt;</span>false<span class="nt">&lt;/use-two-way-ssl&gt;</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">        </span><span class="nt">&lt;/dispatch&gt;</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">    </span><span class="nt">&lt;/service&gt;</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">    </span>....
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="nt">&lt;/topology&gt;</span>
</code></pre></div>
<p>If only <em>role</em> is specified in the topology file (the only required element other than <em>url</em>) then the first service definition of that role found
will be used with the highest version of that role and name. Similarly if only the <em>version</em> is omitted from the topology specification of the service,
the service definition of the highest version will be used. It is therefore important to specify a version for a service if it is desired that
a topology be locked down to a specific version of a service.</p>
<p>The optional <code>dispatch</code> element can be used to override the dispatch specified in service.xml file for the service, this can be useful in cases where you want a specific topology to override the dispatch, which is useful for topology based federation from one Knox instance to another. <code>dispatch\classname</code> is the most commonly used option, but other options are available if one wants more fine grained control over topology dispatch override. </p>
<p><strong>routes</strong>
: Wrapper element for one or more routes.</p>
<p><strong>route</strong>
: A route specifies the <em>path</em> that the service is routing as well as any rewrite bindings or policy bindings. Another child element that may be used here
is a <em>dispatch</em> element.</p>
<p><strong>rewrite</strong>
: A rewrite rule or function that is to be applied to the path. A rewrite element contains a <em>apply</em> attribute that references the rewrite function or rule
by name. Along with the <em>apply</em> attribute, a <em>to</em> attribute must be used. The <em>to</em> specifies what part of the request or response to rewrite.
The valid values for the <em>to</em> attribute are:</p>
<ul>
<li>request.url</li>
<li>request.headers</li>
<li>request.cookies</li>
<li>request.body</li>
<li>response.headers</li>
<li>response.cookies</li>
<li>response.body</li>
</ul>
<p>Below is an example of a snippet from the WebHDFS service definition</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="w">    </span><span class="nt">&lt;route</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/webhdfs/v1/**?**&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">        </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">apply=</span><span class="s">&quot;WEBHDFS/webhdfs/inbound/namenode/file&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;request.url&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">        </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">apply=</span><span class="s">&quot;WEBHDFS/webhdfs/outbound/namenode/headers&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;response.headers&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="nt">&lt;/route&gt;</span>
</code></pre></div>
<p><strong>dispatch</strong>
: The dispatch element can be used to plug-in a custom dispatch class. The interface for Dispatch can be found in the module
gateway-spi, org.apache.knox.gateway.dispatch.Dispatch.</p>
<p>This element can be used at the service level (i.e. as a child of the service tag) or at the route level. A dispatch specified
at the route level takes precedence over a dispatch specified at the service level. By default the dispatch used is
org.apache.knox.gateway.dispatch.DefaultDispatch.</p>
<p>The dispatch tag has four attributes that can be specified.</p>
<p><em>contributor-name</em> : This attribute can be used to specify a deployment contributor to be invoked for a custom dispatch.</p>
<p><em>classname</em> : This attribute can be used to specify a custom dispatch class.</p>
<p><em>ha-contributor-name</em> : This attribute can be used to specify a deployment contributor to be invoked for custom HA dispatch functionality.</p>
<p><em>ha-classname</em> : This attribute can be used to specify a custom dispatch class with HA functionality.</p>
<p>Only one of contributor-name or classname should be specified and one of ha-contributor-name or ha-classname should be specified.</p>
<p>If providing a custom dispatch, either a jar should be provided, see #[Class Path] or a #[Maven Module] should be created.</p>
<p>Check out #[ConfigurableDispatch] about configurable dispatch type. </p>
<p><strong>policies</strong>
: This is a wrapper tag for <em>policy</em> elements and can be a child of the <em>service</em> tag or the <em>route</em> tag. Once again, just like with
dispatch, the route level policies defined override the ones at the service level.</p>
<p>This element can contain one or more <em>policy</em> elements. The order of the <em>policy</em> elements is important as that will be the
order of execution.</p>
<p><strong>policy</strong>
: At this time the policy element just has two attributes, <em>role</em> and <em>name</em>. These are used to execute a deployment contributor
by that role and name. Therefore new policies must be added by using the deployment contributor mechanism.</p>
<p>For example,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nt">&lt;service</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;FOO&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;foo&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.6.0&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="nt">&lt;policies&gt;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">        </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;webappsec&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">        </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;authentication&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">        </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;rewrite&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">        </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;identity-assertion&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;authorization&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="nt">&lt;/policies&gt;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="nt">&lt;routes&gt;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">        </span><span class="nt">&lt;route</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/foo/?**&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">            </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">apply=</span><span class="s">&quot;FOO/foo/inbound&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;request.url&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">            </span><span class="nt">&lt;policies&gt;</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">                </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;webappsec&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">                </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;federation&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">                </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;identity-assertion&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">                </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;authorization&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">                </span><span class="nt">&lt;policy</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;rewrite&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">            </span><span class="nt">&lt;/policies&gt;</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">            </span><span class="nt">&lt;dispatch</span><span class="w"> </span><span class="na">contributor-name=</span><span class="s">&quot;http-client&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">        </span><span class="nt">&lt;/route&gt;</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">    </span><span class="nt">&lt;/routes&gt;</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="w">    </span><span class="nt">&lt;dispatch</span><span class="w"> </span><span class="na">contributor-name=</span><span class="s">&quot;custom-client&quot;</span><span class="w"> </span><span class="na">ha-contributor-name=</span><span class="s">&quot;ha-client&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="nt">&lt;/service&gt;</span>
</code></pre></div>
<h5 id="configurabledispatch">ConfigurableDispatch<a class="headerlink" href="#configurabledispatch" title="Permanent link">&para;</a></h5>
<p>The <code>ConfigurableDispatch</code> allows service definition writers to:</p>
<ul>
<li>exclude certain header(s) from the outbound HTTP request</li>
<li>exclude certain header(s) from the outbound HTTP response</li>
<li>declares whether parameters should be URL-encoded or not</li>
</ul>
<p>This dispatch type can be set in <code>service.xml</code> as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>&lt;dispatch classname=&quot;org.apache.knox.gateway.dispatch.ConfigurableDispatch&quot; ha-classname=&quot;org.apache.knox.gateway.ha.dispatch.ConfigurableHADispatch&quot;&gt;
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>  &lt;param&gt;
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    &lt;name&gt;requestExcludeHeaders&lt;/name&gt;
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    &lt;value&gt;Authorization,Content-Length&lt;/value&gt;
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>  &lt;/param&gt;
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>  &lt;param&gt;
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>    &lt;name&gt;responseExcludeHeaders&lt;/name&gt;
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    &lt;value&gt;SET-COOKIE,WWW-AUTHENTICATE&lt;/value&gt;
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>  &lt;/param&gt;
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>  &lt;param&gt;
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    &lt;name&gt;removeUrlEncoding&lt;/name&gt;
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>    &lt;value&gt;true&lt;/value&gt;
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>  &lt;/param&gt;
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>&lt;/dispatch&gt;
</code></pre></div>
<p>The default values of these parameters are:</p>
<ul>
<li><code>requestExcludeHeaders</code> = <code>Host,Authorization,Content-Length,Transfer-Encoding</code></li>
<li><code>responseExcludeHeaders</code> = <code>SET-COOKIE,WWW-AUTHENTICATE</code></li>
<li><code>removeUrlEncoding</code> = <code>false</code></li>
</ul>
<p>The <code>responseExcludeHeaders</code> handling allows excluding only certain directives of the <code>SET-COOKIE</code> HTTP header. The following sample shows how to ecxlude only the <code>HttpOnly</code> directive from <code>SET-COOKIE</code> and the <code>WWW-AUTHENTICATE</code> header entirely in the routbound response HTTP header:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>&lt;dispatch classname=&quot;org.apache.knox.gateway.dispatch.ConfigurableDispatch&quot; ha-classname=&quot;org.apache.knox.gateway.ha.dispatch.ConfigurableHADispatch&quot;&gt;&gt;
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>  &lt;param&gt;
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    &lt;name&gt;responseExcludeHeaders&lt;/name&gt;
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    &lt;value&gt;WWW-AUTHENTICATE,SET-COOKIE:HttpOnly&lt;/value&gt;
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>  &lt;/param&gt;
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>&lt;/dispatch&gt;
</code></pre></div>
<h5 id="rewritexml">rewrite.xml<a class="headerlink" href="#rewritexml" title="Permanent link">&para;</a></h5>
<p>The rewrite.xml file that accompanies the service.xml file follows the same rules as described in the section #[Rewrite Provider].</p>
<h4 id="service-definition-directory-structure">Service Definition Directory Structure<a class="headerlink" href="#service-definition-directory-structure" title="Permanent link">&para;</a></h4>
<p>On installation of the Knox gateway, the following directory structure can be found under ${GATEWAY_HOME}/data. This
is a mirror of the directories and files under the module gateway-service-definitions.</p>
<div class="highlight"><pre><span></span><code>services
    |______ service name
                    |______ version
                                |______service.xml
                                |______rewrite.xml
</code></pre></div>
<p>For example,</p>
<div class="highlight"><pre><span></span><code>services
    |______ webhdfs
               |______ 2.4.0
                         |______service.xml
                         |______rewrite.xml
</code></pre></div>
<p>To test out a new service, you can just add the appropriate files (service.xml and rewrite.xml) in a directory under
${GATEWAY_HOME}/data/services. If you want to make the service contribution to the Knox build, they files need to go
in the gateway-service-definitions module.</p>
<h4 id="service-definition-runtime-behavior">Service Definition Runtime Behavior<a class="headerlink" href="#service-definition-runtime-behavior" title="Permanent link">&para;</a></h4>
<p>The runtime artifacts as well as the behavior does not change whether the service is plugged in via the deployment
descriptors or through a service.xml file.</p>
<h4 id="custom-dispatch-dependency-injection">Custom Dispatch Dependency Injection<a class="headerlink" href="#custom-dispatch-dependency-injection" title="Permanent link">&para;</a></h4>
<p>When writing a custom dispatch class, one often needs configuration or gateway services. A lightweight dependency injection
system is used that can inject instances of classes or primitives available in the filter configuration's init params or
as a servlet context attribute.</p>
<p>Details of this can be found in the module gateway-util-configinjector and also an example use of it is in the class
org.apache.knox.gateway.dispatch.DefaultDispatch. Look at the following method for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="w"> </span><span class="nd">@Configure</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">   </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setReplayBufferSize</span><span class="p">(</span><span class="nd">@Default</span><span class="p">(</span><span class="s">&quot;8&quot;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">      </span><span class="n">replayBufferSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">   </span><span class="p">}</span>
</code></pre></div>
<h3 id="service-discovery">Service Discovery<a class="headerlink" href="#service-discovery" title="Permanent link">&para;</a></h3>
<p>Knox supports the ability to dynamically determine endpoint URLs in topologies for supported Hadoop services.
<em>This functionality is currently only supported for Ambari-managed Hadoop clusters.</em>
There are a number of these services, which are officially supported, but this set can be extended by modifying the
source or speciyfing external configuration.</p>
<h4 id="service-url-definitions">Service URL Definitions<a class="headerlink" href="#service-url-definitions" title="Permanent link">&para;</a></h4>
<p>The service discovery system determines service URLs by processing mappings of Hadoop service configuration properties and
corresponding URL templates. The knowledge about converting these arbitrary service configuration properties into correct
service endpoint URLs is defined in a configuration file internal to the Ambari service discovery module.</p>
<h5 id="configuration-details">Configuration Details<a class="headerlink" href="#configuration-details" title="Permanent link">&para;</a></h5>
<p>This internal configuration file ( <strong>ambari-service-discovery-url-mappings.xml</strong> ) in the <strong>gateway-discovery-ambari</strong> module is used to specify a
URL template and the associated configuration properties to populate it. A limited degree of conditional logic is supported to accommodate
things like <em>http</em> vs <em>https</em> configurations.</p>
<p>The simplest way to describe its contents will be by examples.</p>
<p><strong>Example 1</strong></p>
<p>The simplest example of one such mapping involves a service component for which there is a single configuration property which specifies
the complete URL</p>
<div class="highlight"><pre><span></span><code>&lt;!-- This is the service mapping declaration. The name must match what is specified as a Knox topology service role --&gt;
&lt;service name=&quot;OOZIE&quot;&gt;

  &lt;!-- This is the URL pattern with palceholder(s) for values provided by properties --&gt;
  &lt;url-pattern&gt;{OOZIE_URL}&lt;/url-pattern&gt;

  &lt;properties&gt;

    &lt;!-- This is a property, which in this simple case, matches a template placeholder --&gt;
    &lt;property name=&quot;OOZIE_URL&quot;&gt;

      &lt;!-- This is the component whose configuration will be used to lookup the value of the subsequent config property name --&gt;
      &lt;component&gt;OOZIE_SERVER&lt;/component&gt;

      &lt;!-- This is the name of the component config property whose value should be assigned to the OOZIE_URL value --&gt;
      &lt;config-property&gt;oozie.base.url&lt;/config-property&gt;

    &lt;/property&gt;
  &lt;/properties&gt;
&lt;/service&gt;
</code></pre></div>
<p>The <em>OOZIE_SERVER</em> component configuration is <strong>oozie-site</strong>
If <strong>oozie-site.xml</strong> has the property named <strong>oozie.base.url</strong> with the value http://ooziehost:11000, then the resulting URL for the <em>OOZIE</em>
service will be http://ooziehost:11000</p>
<p><strong>Example 2</strong></p>
<p>A slightly more complicated example involves a service component for which the complete URL is not described by a single detail, but
rather multiple endpoint URL details</p>
<div class="highlight"><pre><span></span><code>&lt;service name=&quot;WEBHCAT&quot;&gt;
  &lt;url-pattern&gt;http://{HOST}:{PORT}/templeton&lt;/url-pattern&gt;
  &lt;properties&gt;
    &lt;property name=&quot;HOST&quot;&gt;
      &lt;component&gt;WEBHCAT_SERVER&lt;/component&gt;

      &lt;!-- This tells discovery to get the hostname for the WEBHCAT_SERVER component from Ambari --&gt;
      &lt;hostname/&gt;

    &lt;/property&gt;
    &lt;property name=&quot;PORT&quot;&gt;
      &lt;component&gt;WEBHCAT_SERVER&lt;/component&gt;

      &lt;!-- This is the name of the component config property whose value should be assigned to --&gt;
      &lt;!-- the PORT value --&gt;
      &lt;config-property&gt;templeton.port&lt;/config-property&gt;

    &lt;/property&gt;
  &lt;/properties&gt;
&lt;/service&gt;
</code></pre></div>
<p><strong>Example 3</strong></p>
<p>An even more complicated example involves a service for which <em>HTTPS</em> is supported, and which employs the limited conditional
logic support</p>
<div class="highlight"><pre><span></span><code>&lt;service name=&quot;ATLAS&quot;&gt;
  &lt;url-pattern&gt;{SCHEME}://{HOST}:{PORT}&lt;/url-pattern&gt;
  &lt;properties&gt;

    &lt;!-- Property for getting the ATLAS_SERVER component hostname from Ambari --&gt;
    &lt;property name=&quot;HOST&quot;&gt;
      &lt;component&gt;ATLAS_SERVER&lt;/component&gt;
      &lt;hostname/&gt;
    &lt;/property&gt;

    &lt;!-- Property for capturing whether TLS is enabled or not; This is not a template placeholder property --&gt;
    &lt;property name=&quot;TLS_ENABLED&quot;&gt;
      &lt;component&gt;ATLAS_SERVER&lt;/component&gt;
      &lt;config-property&gt;atlas.enableTLS&lt;/config-property&gt;
    &lt;/property&gt;
    &lt;!-- Property for getting the http port ; also NOT a template placeholder property --&gt;
    &lt;property name=&quot;HTTP_PORT&quot;&gt;
      &lt;component&gt;ATLAS_SERVER&lt;/component&gt;
      &lt;config-property&gt;atlas.server.http.port&lt;/config-property&gt;
    &lt;/property&gt;

    &lt;!-- Property for getting the https port ; also NOT a template placeholder property --&gt;
    &lt;property name=&quot;HTTPS_PORT&quot;&gt;
      &lt;component&gt;ATLAS_SERVER&lt;/component&gt;
      &lt;config-property&gt;atlas.server.https.port&lt;/config-property&gt;
    &lt;/property&gt;

    &lt;!-- Template placeholder property, dependent on the TLS_ENABLED property value --&gt;
    &lt;property name=&quot;PORT&quot;&gt;
      &lt;config-property&gt;
        &lt;if property=&quot;TLS_ENABLED&quot; value=&quot;true&quot;&gt;
          &lt;then&gt;HTTPS_PORT&lt;/then&gt;
          &lt;else&gt;HTTP_PORT&lt;/else&gt;
        &lt;/if&gt;
      &lt;/config-property&gt;
    &lt;/property&gt;

    &lt;!-- Template placeholder property, dependent on the TLS_ENABLED property value --&gt;
    &lt;property name=&quot;SCHEME&quot;&gt;
      &lt;config-property&gt;
        &lt;if property=&quot;TLS_ENABLED&quot; value=&quot;true&quot;&gt;
          &lt;then&gt;https&lt;/then&gt;
          &lt;else&gt;http&lt;/else&gt;
        &lt;/if&gt;
      &lt;/config-property&gt;
    &lt;/property&gt;
  &lt;/properties&gt;
&lt;/service&gt;
</code></pre></div>
<h5 id="external-configuration">External Configuration<a class="headerlink" href="#external-configuration" title="Permanent link">&para;</a></h5>
<p>The internal configuration for URL construction can be overridden or augmented by way of a configuration file in the gateway
configuration directory, or an alternative file specified by a Java system property. This mechanism is useful for developing
support for new services, for custom solutions, or any scenario for which rebuilding Knox is not desirable.</p>
<p>The default file, for which Knox will search first, is <strong><em>{GATEWAY_HOME}</em>/conf/ambari-discovery-url-mappings.xml</strong></p>
<p>If Knox doesn't find that file, it will check for a Java system property named <strong>org.apache.gateway.topology.discovery.ambari.config</strong>,
whose value is the fully-qualified path to an XML file. This file's contents must adhere to the format outlined above.</p>
<p>If this configuration exists, Knox will apply it as if it were part of the internal configuration.</p>
<p><strong>Example</strong></p>
<p>If Apache Solr weren't supported, then it could be added by creating the following definition in
<strong><em>{GATEWAY_HOME}</em>/conf/ambari-discovery-url-mappings.xml</strong> :</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;service-discovery-url-mappings&gt;
  &lt;service name=&quot;SOLR&quot;&gt;
    &lt;url-pattern&gt;http://{HOST}:{PORT}&lt;/url-pattern&gt;
    &lt;properties&gt;
      &lt;property name=&quot;HOST&quot;&gt;
        &lt;component&gt;INFRA_SOLR&lt;/component&gt;
        &lt;hostname/&gt;
      &lt;/property&gt;
      &lt;property name=&quot;PORT&quot;&gt;
        &lt;component&gt;INFRA_SOLR&lt;/component&gt;
        &lt;config-property&gt;infra_solr_port&lt;/config-property&gt;
      &lt;/property&gt;
    &lt;/properties&gt;
  &lt;/service&gt;
&lt;/service-discovery-url-mappings&gt;
</code></pre></div>
<p><strong><em>N.B. Knox must be restarted for changes to this external configuration to be applied.</em></strong></p>
<h4 id="component-configuration-mapping">Component Configuration Mapping<a class="headerlink" href="#component-configuration-mapping" title="Permanent link">&para;</a></h4>
<p>To support URL construction from service configuration files, Ambari service discovery requires knowledge of the service component types and
their respective relationships to configuration types. This knowledge is defined in a configuration file internal to the Ambari service discovery
module.</p>
<h5 id="configuration-details_1">Configuration Details<a class="headerlink" href="#configuration-details_1" title="Permanent link">&para;</a></h5>
<p>This internal configuration file ( <strong>ambari-service-discovery-component-config-mapping.properties</strong> ) in the <strong>gateway-discovery-ambari</strong> module is
used to define the mapping of Hadoop service component names to the configuration type from which Knox will lookup property values.</p>
<p><strong>Example</strong></p>
<div class="highlight"><pre><span></span><code>NAMENODE=hdfs-site
RESOURCEMANAGER=yarn-site
HISTORYSERVER=mapred-site
OOZIE_SERVER=oozie-site
HIVE_SERVER=hive-site
WEBHCAT_SERVER=webhcat-site
</code></pre></div>
<h5 id="external-configuration_1">External Configuration<a class="headerlink" href="#external-configuration_1" title="Permanent link">&para;</a></h5>
<p>The internal configuration for component configuration mappings can be overridden or augmented by way of a configuration file in the gateway
configuration directory, or an alternative file specified by a Java system property. This mechanism is useful for developing support for new services,
for custom solutions, or any scenario for which rebuilding Knox is not desirable.</p>
<p>The default file, for which Knox will search first, is <strong><em>{GATEWAY_HOME}</em>/conf/ambari-discovery-component-config.properties</strong>
If Knox doesn't find that file, it will check for a Java system property named <strong>org.apache.knox.gateway.topology.discovery.ambari.component.mapping</strong>,
whose value is the fully-qualified path to a properties file. This file's contents must adhere to the format outlined above.</p>
<p>If this configuration exists, Knox will apply it as if it were part of the internal configuration.</p>
<p><strong>Example</strong></p>
<p>Following the aforementioned SOLR example, Knox needs to know in which configuration file to find the <em>INFRA_SOLR</em> component configuration property, so
the following property must be defined in <strong><em>{GATEWAY_HOME}</em>/conf/ambari-discovery-component-config.properties</strong> :</p>
<div class="highlight"><pre><span></span><code>INFRA_SOLR=infra-solr-env
</code></pre></div>
<p>This tells Knox to look for the <strong>infra_solr_port</strong> property in the <strong>infra-solr-env</strong> configuration.</p>
<p><strong><em>N.B. Knox must be restarted for changes to this external configuration to be applied.</em></strong></p>
<h3 id="validator">Validator<a class="headerlink" href="#validator" title="Permanent link">&para;</a></h3>
<p>Apache Knox provides preauth federation authentication where<br />
Knox supports two built-in validators for verifying incoming requests. In this section, we describe how to write a custom validator for this scenario. The provided validators include: </p>
<ul>
<li><em>preauth.default.validation:</em> This default behavior does not perform any validation check. All requests will pass.</li>
<li><em>preauth.ip.validation</em> : This validation checks if a request is originated from an IP address which is configured in Knox service through property <em>preauth.ip.addresses</em>.</li>
</ul>
<p>However, these built-in validation choices may not fulfill the internal requirments of some organization. Therefore, Knox supports (since 0.12) a pluggble framework where anyone can include a custom validator. </p>
<p>In essence, a user can add a custom validator by following these  steps. The corresponding code examples are incorporated after that:</p>
<ol>
<li>Create a separate Java package (e.g. com.company.knox.validator) in a new or existing Maven project.</li>
<li>Create a new class (e.g. <em>CustomValidator</em>) that implements <em>org.apache.knox.gateway.preauth.filter.PreAuthValidator</em>.</li>
<li>The class should implement the method <em>String getName()</em> that may returns a string constant. The step-9  will need this user defined string constant.</li>
<li>The class should implement the method <em>boolean validate(HttpServletRequest httpRequest, FilterConfig filterConfig)</em>. This is the key method which will validate the request based on 'httpRequest' and 'filterConfig'. In most common cases, user may need to use HTTP headers value to validate. For example, client can get a token from an authentication service and pass it as HTTP header. This validate method needs to extract that header and verify the token. In some instance, the server may need to contact the same authentication service to validate.</li>
<li>Create a text file src/resources/META-INF/services and add fully qualified name of your custom validator class (e.g. <em>com.company.knox.validator.CustomValidator</em>).</li>
<li>You may need to include the packages "org.apache.knox.gateway-provider-security-preauth"  of version 0.12+ and  "javax.servlet.javax.servlet-api" of version 3.1.0+ in pom.xml.</li>
<li>Build your custom jar.</li>
<li>Deploy the jar in $GATEWAY_HOME/ext directory.</li>
<li>Add/modify a parameter called <em>preauth.validation.method</em> with the name of validator used in step #3. Optionally, you may add any new parameter that may be required only for your CustomValidator.</li>
</ol>
<p><strong>Validator Class (Step 2-4)</strong> </p>
<div class="highlight"><pre><span></span><code>package com.company.knox.validator;

import org.apache.knox.gateway.preauth.filter.PreAuthValidationException;
import org.apache.knox.gateway.preauth.filter.PreAuthValidator;
import com.google.common.base.Strings;

import javax.servlet.FilterConfig;
import javax.servlet.http.HttpServletRequest;

public class CustomValidator extends PreAuthValidator {
  //Any string constant value should work for these 3 variables
  //This string will be used in &#39;services&#39; file.
  public static final String CUSTOM_VALIDATOR_NAME = &quot;fooValidator&quot;; 
  //Optional: User may want to pass soemthign through HTTP header. (per client request)
  public static final String CUSTOM_TOKEN_HEADER_NAME = &quot;foo_claim&quot;;


  /**
   * @param httpRequest
   * @param filterConfig
   * @return
   * @throws PreAuthValidationException
   */
  @Override
  public boolean validate(HttpServletRequest httpRequest, FilterConfig filterConfig) throws PreAuthValidationException {
    String claimToken = httpRequest.getHeader(CUSTOM_TOKEN_HEADER_NAME);
    if (!Strings.isNullOrEmpty(claimToken)) {
      return checkCustomeToken(claimToken); //to be implemented
    } else {
      log.warn(&quot;Claim token was empty for header name &#39;&quot; + CUSTOM_TOKEN_HEADER_NAME + &quot;&#39;&quot;);
      return false;
    }
  }

  /**
   * Define unique validator name
   *
   * @return
   */
  @Override
  public String getName() {
    return CUSTOM_VALIDATOR_NAME;
  }
}
</code></pre></div>
<p><strong>META-INF/services contents (Step-5)</strong></p>
<p><code>com.company.knox.validator.CustomValidator</code></p>
<p><strong>POM file (Step-6)</strong></p>
<div class="highlight"><pre><span></span><code>&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.apache.knox&lt;/groupId&gt;
    &lt;artifactId&gt;gateway-test-utils&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.apache.knox&lt;/groupId&gt;
    &lt;artifactId&gt;gateway-provider-security-preauth&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre></div>
<p><strong>Deploy Custom Jar (Step-7-8)</strong></p>
<p>Build the jar (e.g. customValidation.jar) using 'mvn clean package'
<code>cp customValidation.jar $GATEWAY_HOME/ext/</code></p>
<p><strong>Topology Config (Step-9)</strong></p>
<div class="highlight"><pre><span></span><code>&lt;provider&gt;
    &lt;role&gt;federation&lt;/role&gt;
    &lt;name&gt;HeaderPreAuth&lt;/name&gt;
    &lt;enabled&gt;true&lt;/enabled&gt;
    &lt;param&gt;&lt;name&gt;preauth.validation.method&lt;/name&gt;
    &lt;!--Same as CustomeValidator.CUSTOM_VALIDATOR_NAME   -&gt;
    &lt;value&gt;fooValidator&lt;/value&gt;&lt;/param&gt;
&lt;/provider&gt;
</code></pre></div>
<h3 id="providers">Providers<a class="headerlink" href="#providers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ProviderDeploymentContributor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">getRole</span><span class="p">();</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">();</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">initializeContribution</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeProvider</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Provider</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeFilter</span><span class="p">(</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">      </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">      </span><span class="n">Provider</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">      </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">      </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">FilterParamDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">finalizeContribution</span><span class="p">(</span><span class="w"> </span><span class="n">DeploymentContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nt">&lt;project&gt;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.knox<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>gateway<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>2.1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gateway-provider-security-authn-sample<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>gateway-provider-security-authn-sample<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>A<span class="w"> </span>simple<span class="w"> </span>sample<span class="w"> </span>authorization<span class="w"> </span>provider.<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="nt">&lt;licenses&gt;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">        </span><span class="nt">&lt;license&gt;</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>The<span class="w"> </span>Apache<span class="w"> </span>Software<span class="w"> </span>License,<span class="w"> </span>Version<span class="w"> </span>2.0<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://www.apache.org/licenses/LICENSE-2.0.txt<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">            </span><span class="nt">&lt;distribution&gt;</span>repo<span class="nt">&lt;/distribution&gt;</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">        </span><span class="nt">&lt;/license&gt;</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">    </span><span class="nt">&lt;/licenses&gt;</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>${gateway-group}<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>gateway-spi<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>
<a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div>
<h3 id="deployment-context">Deployment Context<a class="headerlink" href="#deployment-context" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.deploy</span><span class="p">;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">...</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DeploymentContext</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">  </span><span class="n">GatewayConfig</span><span class="w"> </span><span class="nf">getGatewayConfig</span><span class="p">();</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">  </span><span class="n">Topology</span><span class="w"> </span><span class="nf">getTopology</span><span class="p">();</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">  </span><span class="n">WebArchive</span><span class="w"> </span><span class="nf">getWebArchive</span><span class="p">();</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">  </span><span class="n">WebAppDescriptor</span><span class="w"> </span><span class="nf">getWebAppDescriptor</span><span class="p">();</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">  </span><span class="n">GatewayDescriptor</span><span class="w"> </span><span class="nf">getGatewayDescriptor</span><span class="p">();</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">contributeFilter</span><span class="p">(</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">      </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">      </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span>
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a><span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">FilterParamDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a>
<a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">addDescriptor</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">descriptor</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>
<a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getDescriptor</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a>
<a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Topology</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">URI</span><span class="w"> </span><span class="nf">getUri</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUri</span><span class="p">(</span><span class="w"> </span><span class="n">URI</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setName</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getTimestamp</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTimestamp</span><span class="p">(</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getServices</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="nf">getService</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">role</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addService</span><span class="p">(</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Provider</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getProviders</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Provider</span><span class="w"> </span><span class="nf">getProvider</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">role</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProvider</span><span class="p">(</span><span class="w"> </span><span class="n">Provider</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">GatewayDescriptor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">GatewayParamDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">params</span><span class="p">();</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="n">GatewayParamDescriptor</span><span class="w"> </span><span class="nf">addParam</span><span class="p">();</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="n">GatewayParamDescriptor</span><span class="w"> </span><span class="nf">createParam</span><span class="p">();</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">addParam</span><span class="p">(</span><span class="w"> </span><span class="n">GatewayParamDescriptor</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">addParams</span><span class="p">(</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">GatewayParamDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ResourceDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">resources</span><span class="p">();</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="nf">addResource</span><span class="p">();</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="nf">createResource</span><span class="p">();</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">addResource</span><span class="p">(</span><span class="w"> </span><span class="n">ResourceDescriptor</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="p">}</span>
</code></pre></div>
<h3 id="gateway-services">Gateway Services<a class="headerlink" href="#gateway-services" title="Permanent link">&para;</a></h3>
<p>TODO - Describe the service registry and other global services.</p>
<h2 id="standard-providers">Standard Providers<a class="headerlink" href="#standard-providers" title="Permanent link">&para;</a></h2>
<h3 id="rewrite-provider">Rewrite Provider<a class="headerlink" href="#rewrite-provider" title="Permanent link">&para;</a></h3>
<p>gateway-provider-rewrite
org.apache.knox.gateway.filter.rewrite.api.UrlRewriteRulesDescriptor</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nt">&lt;rule</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">      </span><span class="na">dir=</span><span class="s">&quot;IN&quot;</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">      </span><span class="na">name=</span><span class="s">&quot;WEATHER/openweathermap/inbound/versioned/file&quot;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">      </span><span class="na">pattern=</span><span class="s">&quot;*://*:*/**/weather/{version}?{**}&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">template=</span><span class="s">&quot;{$serviceUrl[WEATHER]}/{version}/weather?{**}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">  </span><span class="nt">&lt;/rule&gt;</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WEBHBASE/webhbase/status/outbound&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;*/json&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">      </span><span class="nt">&lt;apply</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;$[LiveNodes][*][name]&quot;</span><span class="w"> </span><span class="na">rule=</span><span class="s">&quot;WEBHBASE/webhbase/address/outbound&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="nt">&lt;/content&gt;</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;*/xml&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">      </span><span class="nt">&lt;apply</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/ClusterStatus/LiveNodes/Node/@name&quot;</span><span class="w"> </span><span class="na">rule=</span><span class="s">&quot;WEBHBASE/webhbase/address/outbound&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span><span class="nt">&lt;/content&gt;</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="nt">&lt;/filter&gt;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nd">@Test</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testDevGuideSample</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="n">URI</span><span class="w"> </span><span class="n">inputUri</span><span class="p">,</span><span class="w"> </span><span class="n">outputUri</span><span class="p">;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">matcher</span><span class="p">;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">.</span><span class="na">Match</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="n">Template</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">  </span><span class="n">inputUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URI</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://sample-host:8443/gateway/topology/weather/2.5?q=Palo+Alto&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="n">inputUri</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="w">  </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;*://*:*/**/weather/{version}?{**}&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">  </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://api.openweathermap.org/data/{version}/weather?{**}&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="w">  </span><span class="n">matcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">  </span><span class="n">matcher</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matcher</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">  </span><span class="n">outputUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expander</span><span class="p">.</span><span class="na">expand</span><span class="p">(</span><span class="w"> </span><span class="n">template</span><span class="p">,</span><span class="w"> </span><span class="n">match</span><span class="p">.</span><span class="na">getParams</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="w">  </span><span class="n">assertThat</span><span class="p">(</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">      </span><span class="n">outputUri</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="w">      </span><span class="n">is</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?q=Palo+Alto&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nd">@Test</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testDevGuideSampleWithEvaluator</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span><span class="n">URI</span><span class="w"> </span><span class="n">inputUri</span><span class="p">,</span><span class="w"> </span><span class="n">outputUri</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">matcher</span><span class="p">;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">  </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">.</span><span class="na">Match</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">  </span><span class="n">Template</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">  </span><span class="n">Evaluator</span><span class="w"> </span><span class="n">evaluator</span><span class="p">;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">  </span><span class="n">inputUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URI</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://sample-host:8443/gateway/topology/weather/2.5?q=Palo+Alto&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="n">inputUri</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">  </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;*://*:*/**/weather/{version}?{**}&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">  </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;{$serviceUrl[WEATHER]}/{version}/weather?{**}&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">  </span><span class="n">matcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">  </span><span class="n">matcher</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matcher</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">  </span><span class="n">evaluator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Evaluator</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://api.openweathermap.org/data&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="w">  </span><span class="n">outputUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expander</span><span class="p">.</span><span class="na">expand</span><span class="p">(</span><span class="w"> </span><span class="n">template</span><span class="p">,</span><span class="w"> </span><span class="n">match</span><span class="p">.</span><span class="na">getParams</span><span class="p">(),</span><span class="w"> </span><span class="n">evaluator</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="w">  </span><span class="n">assertThat</span><span class="p">(</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">      </span><span class="n">outputUri</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="w">      </span><span class="n">is</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?q=Palo+Alto&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="p">}</span>
</code></pre></div>
<h4 id="rewrite-filters">Rewrite Filters<a class="headerlink" href="#rewrite-filters" title="Permanent link">&para;</a></h4>
<p>TODO - Cover the supported content types.
TODO - Provide a XML and JSON "properties" example where one NVP is modified based on value of another name.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WEBHBASE/webhbase/regions/outbound&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;*/json&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">      </span><span class="nt">&lt;apply</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;$[Region][*][location]&quot;</span><span class="w"> </span><span class="na">rule=</span><span class="s">&quot;WEBHBASE/webhbase/address/outbound&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="nt">&lt;/content&gt;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;*/xml&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">      </span><span class="nt">&lt;apply</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/TableInfo/Region/@location&quot;</span><span class="w"> </span><span class="na">rule=</span><span class="s">&quot;WEBHBASE/webhbase/address/outbound&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">    </span><span class="nt">&lt;/content&gt;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">  </span><span class="nt">&lt;/filter&gt;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nt">&lt;gateway&gt;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span>...
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="nt">&lt;resource&gt;</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="nt">&lt;role&gt;</span>WEBHBASE<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="nt">&lt;pattern&gt;</span>/hbase/*/regions?**<span class="nt">&lt;/pattern&gt;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span>...
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">      </span><span class="nt">&lt;role&gt;</span>rewrite<span class="nt">&lt;/role&gt;</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">      </span><span class="nt">&lt;name&gt;</span>url-rewrite<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">      </span><span class="nt">&lt;class&gt;</span>org.apache.knox.gateway.filter.rewrite.api.UrlRewriteServletFilter<span class="nt">&lt;/class&gt;</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">      </span><span class="nt">&lt;param&gt;</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>response.body<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>WEBHBASE/webhbase/regions/outbound<span class="nt">&lt;/value&gt;</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">      </span><span class="nt">&lt;/param&gt;</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">    </span>...
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">  </span><span class="nt">&lt;/resource&gt;</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">  </span>...
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="nt">&lt;/gateway&gt;</span>
</code></pre></div>
<p>HBaseDeploymentContributor
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="w">    </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">FilterParamDescriptor</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">    </span><span class="n">params</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"> </span><span class="n">regionResource</span><span class="p">.</span><span class="na">createFilterParam</span><span class="p">().</span><span class="na">name</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;response.body&quot;</span><span class="w"> </span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;WEBHBASE/webhbase/regions/outbound&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="n">addRewriteFilter</span><span class="p">(</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">regionResource</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">);</span>
</code></pre></div></p>
<h4 id="rewrite-functions">Rewrite Functions<a class="headerlink" href="#rewrite-functions" title="Permanent link">&para;</a></h4>
<p>TODO - Provide an lowercase function as an example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="nt">&lt;functions&gt;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="nt">&lt;hostmap</span><span class="w"> </span><span class="na">config=</span><span class="s">&quot;/WEB-INF/hostmap.txt&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">  </span><span class="nt">&lt;/functions&gt;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span>...
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<h4 id="rewrite-steps">Rewrite Steps<a class="headerlink" href="#rewrite-steps" title="Permanent link">&para;</a></h4>
<p>TODO - Provide an lowercase step as an example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nt">&lt;rules&gt;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">dir=</span><span class="s">&quot;OUT&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WEBHDFS/webhdfs/outbound/namenode/headers/location&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="nt">&lt;match</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;{scheme}://{host}:{port}/{path=**}?{**}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="nt">&lt;rewrite</span><span class="w"> </span><span class="na">template=</span><span class="s">&quot;{gateway.url}/webhdfs/data/v1/{path=**}?{scheme}?host={$hostmap(host)}?{port}?{**}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="nt">&lt;encrypt-query/&gt;</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span><span class="nt">&lt;/rule&gt;</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="nt">&lt;/rules&gt;</span>
</code></pre></div>
<h3 id="identity-assertion-provider">Identity Assertion Provider<a class="headerlink" href="#identity-assertion-provider" title="Permanent link">&para;</a></h3>
<p>Adding a new identity assertion provider is as simple as extending the AbstractIdentityAsserterDeploymentContributor and the CommonIdentityAssertionFilter from the gateway-provider-identity-assertion-common module to initialize any specific configuration from filter init params and implement two methods:</p>
<ol>
<li>String mapUserPrincipal(String principalName);</li>
<li>String[] mapGroupPrincipals(String principalName, Subject subject);</li>
</ol>
<p>To implement a simple toUpper or toLower identity assertion provider:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.identityasserter.caseshifter.filter</span><span class="p">;</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.identityasserter.common.filter.AbstractIdentityAsserterDeploymentContributor</span><span class="p">;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CaseShifterIdentityAsserterDeploymentContributor</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractIdentityAsserterDeploymentContributor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;CaseShifter&quot;</span><span class="p">;</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getFilterClassname</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CaseShifterIdentityAssertionFilter</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="p">}</span>
</code></pre></div>
We merely need to provide the provider name for use in the topology and the filter classname for the contributor to add to the filter chain.</p>
<p>For the identity assertion filter itself it is just a matter of extension and the implementation of the two methods described earlier:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.identityasserter.caseshifter.filter</span><span class="p">;</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.security.auth.Subject</span><span class="p">;</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.servlet.FilterConfig</span><span class="p">;</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.servlet.ServletException</span><span class="p">;</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.knox.gateway.identityasserter.common.filter.CommonIdentityAssertionFilter</span><span class="p">;</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CaseShifterIdentityAssertionFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CommonIdentityAssertionFilter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">toUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">FilterConfig</span><span class="w"> </span><span class="n">filterConfig</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filterConfig</span><span class="p">.</span><span class="na">getInitParameter</span><span class="p">(</span><span class="s">&quot;caseshift.upper&quot;</span><span class="p">);</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">upper</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">      </span><span class="n">toUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">      </span><span class="n">toUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="nf">mapGroupPrincipals</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">mappedPrincipalName</span><span class="p">,</span><span class="w"> </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a>
<a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">mapUserPrincipal</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">principalName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">toUpper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="w">      </span><span class="n">principalName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">principalName</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">();</span>
<a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a><span class="w">      </span><span class="n">principalName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">principalName</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">();</span>
<a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">principalName</span><span class="p">;</span>
<a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="p">}</span>
</code></pre></div>
<p>Note that the above: </p>
<ol>
<li>looks for specific filter init parameters for configuration of whether to convert to upper or to lower case</li>
<li>it no-ops the mapGroupPrincipals so that it returns null. This indicates that there are no changes needed to the groups contained within the Subject. If there are groups then they should be continued to flow through the system unchanged. This is actually the same implementation as the base class and is therefore not required to be overridden. We include it here for illustration.</li>
<li>based upon the configuration interrogated in the init method the principalName is convert to either upper or lower case.</li>
</ol>
<p>That is the extent of what is needed to implement a new identity assertion provider module.</p>
<h3 id="jersey-provider">Jersey Provider<a class="headerlink" href="#jersey-provider" title="Permanent link">&para;</a></h3>
<p>TODO</p>
<h3 id="knoxsso-integration">KnoxSSO Integration<a class="headerlink" href="#knoxsso-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>@startuml
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>!include knoxsso_integration.puml
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>@enduml
</code></pre></div>
<h3 id="health-monitoring-api">Health Monitoring API<a class="headerlink" href="#health-monitoring-api" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>@startuml
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>!include knox_monitoring_api.puml
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>@enduml
</code></pre></div>
<h2 id="auditing">Auditing<a class="headerlink" href="#auditing" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuditingSample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Auditor</span><span class="w"> </span><span class="n">AUDITOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AuditServiceFactory</span><span class="p">.</span><span class="na">getAuditService</span><span class="p">().</span><span class="na">getAuditor</span><span class="p">(</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">      </span><span class="s">&quot;sample-channel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample-service&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample-component&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sampleMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">      </span><span class="p">...</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">      </span><span class="n">AUDITOR</span><span class="p">.</span><span class="na">audit</span><span class="p">(</span><span class="w"> </span><span class="n">Action</span><span class="p">.</span><span class="na">AUTHORIZATION</span><span class="p">,</span><span class="w"> </span><span class="n">sourceUrl</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceType</span><span class="p">.</span><span class="na">URI</span><span class="p">,</span><span class="w"> </span><span class="n">ActionOutcome</span><span class="p">.</span><span class="na">SUCCESS</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">      </span><span class="p">...</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="p">}</span>
</code></pre></div>
<h2 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nd">@Messages</span><span class="p">(</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;org.apache.project.module&quot;</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomMessages</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">  </span><span class="nd">@Message</span><span class="p">(</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageLevel</span><span class="p">.</span><span class="na">FATAL</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Failed to parse command line: {0}&quot;</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">failedToParseCommandLine</span><span class="p">(</span><span class="w"> </span><span class="nd">@StackTrace</span><span class="p">(</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageLevel</span><span class="p">.</span><span class="na">DEBUG</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ParseException</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomLoggingSample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">GatewayMessages</span><span class="w"> </span><span class="n">MSG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessagesFactory</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="w"> </span><span class="n">GatewayMessages</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sampleMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="n">MSG</span><span class="p">.</span><span class="na">failedToParseCommandLine</span><span class="p">(</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="p">}</span>
</code></pre></div>
<h2 id="internationalization">Internationalization<a class="headerlink" href="#internationalization" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nd">@Resources</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomResources</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="nd">@Resource</span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Apache Hadoop Gateway {0} ({1})&quot;</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">gatewayVersionMessage</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomResourceSample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">GatewayResources</span><span class="w"> </span><span class="n">RES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourcesFactory</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="w"> </span><span class="n">GatewayResources</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sampleMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RES</span><span class="p">.</span><span class="na">gatewayVersionMessage</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;0.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;XXXXXXX&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="p">}</span>
</code></pre></div>
<h2 id="admin-ui">Admin UI<a class="headerlink" href="#admin-ui" title="Permanent link">&para;</a></h2>
<p>&lt;<admin-ui.md>&gt;</p>
<p>&lt;&lt;../../common/footer.md&gt;&gt;</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.highlight", "search.share", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>