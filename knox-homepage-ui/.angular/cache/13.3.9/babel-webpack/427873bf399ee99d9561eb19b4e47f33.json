{"ast":null,"code":"import _inherits from \"/Users/mbalazs/projects/knox/knox-homepage-ui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/mbalazs/projects/knox/knox-homepage-ui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _classCallCheck from \"/Users/mbalazs/projects/knox/knox-homepage-ui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/mbalazs/projects/knox/knox-homepage-ui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function expand(project) {\n  var concurrent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.POSITIVE_INFINITY;\n  var scheduler = arguments.length > 2 ? arguments[2] : undefined;\n  concurrent = (concurrent || 0) < 1 ? Number.POSITIVE_INFINITY : concurrent;\n  return function (source) {\n    return source.lift(new ExpandOperator(project, concurrent, scheduler));\n  };\n}\nexport var ExpandOperator = /*#__PURE__*/function () {\n  function ExpandOperator(project, concurrent, scheduler) {\n    _classCallCheck(this, ExpandOperator);\n\n    this.project = project;\n    this.concurrent = concurrent;\n    this.scheduler = scheduler;\n  }\n\n  _createClass(ExpandOperator, [{\n    key: \"call\",\n    value: function call(subscriber, source) {\n      return source.subscribe(new ExpandSubscriber(subscriber, this.project, this.concurrent, this.scheduler));\n    }\n  }]);\n\n  return ExpandOperator;\n}();\nexport var ExpandSubscriber = /*#__PURE__*/function (_SimpleOuterSubscribe) {\n  _inherits(ExpandSubscriber, _SimpleOuterSubscribe);\n\n  var _super = _createSuper(ExpandSubscriber);\n\n  function ExpandSubscriber(destination, project, concurrent, scheduler) {\n    var _this;\n\n    _classCallCheck(this, ExpandSubscriber);\n\n    _this = _super.call(this, destination);\n    _this.project = project;\n    _this.concurrent = concurrent;\n    _this.scheduler = scheduler;\n    _this.index = 0;\n    _this.active = 0;\n    _this.hasCompleted = false;\n\n    if (concurrent < Number.POSITIVE_INFINITY) {\n      _this.buffer = [];\n    }\n\n    return _this;\n  }\n\n  _createClass(ExpandSubscriber, [{\n    key: \"_next\",\n    value: function _next(value) {\n      var destination = this.destination;\n\n      if (destination.closed) {\n        this._complete();\n\n        return;\n      }\n\n      var index = this.index++;\n\n      if (this.active < this.concurrent) {\n        destination.next(value);\n\n        try {\n          var project = this.project;\n          var result = project(value, index);\n\n          if (!this.scheduler) {\n            this.subscribeToProjection(result, value, index);\n          } else {\n            var state = {\n              subscriber: this,\n              result: result,\n              value: value,\n              index: index\n            };\n            var _destination = this.destination;\n\n            _destination.add(this.scheduler.schedule(ExpandSubscriber.dispatch, 0, state));\n          }\n        } catch (e) {\n          destination.error(e);\n        }\n      } else {\n        this.buffer.push(value);\n      }\n    }\n  }, {\n    key: \"subscribeToProjection\",\n    value: function subscribeToProjection(result, value, index) {\n      this.active++;\n      var destination = this.destination;\n      destination.add(innerSubscribe(result, new SimpleInnerSubscriber(this)));\n    }\n  }, {\n    key: \"_complete\",\n    value: function _complete() {\n      this.hasCompleted = true;\n\n      if (this.hasCompleted && this.active === 0) {\n        this.destination.complete();\n      }\n\n      this.unsubscribe();\n    }\n  }, {\n    key: \"notifyNext\",\n    value: function notifyNext(innerValue) {\n      this._next(innerValue);\n    }\n  }, {\n    key: \"notifyComplete\",\n    value: function notifyComplete() {\n      var buffer = this.buffer;\n      this.active--;\n\n      if (buffer && buffer.length > 0) {\n        this._next(buffer.shift());\n      }\n\n      if (this.hasCompleted && this.active === 0) {\n        this.destination.complete();\n      }\n    }\n  }], [{\n    key: \"dispatch\",\n    value: function dispatch(arg) {\n      var subscriber = arg.subscriber,\n          result = arg.result,\n          value = arg.value,\n          index = arg.index;\n      subscriber.subscribeToProjection(result, value, index);\n    }\n  }]);\n\n  return ExpandSubscriber;\n}(SimpleOuterSubscriber);","map":{"version":3,"sources":["/Users/mbalazs/projects/knox/knox-homepage-ui/node_modules/rxjs/_esm2015/internal/operators/expand.js"],"names":["SimpleOuterSubscriber","innerSubscribe","SimpleInnerSubscriber","expand","project","concurrent","Number","POSITIVE_INFINITY","scheduler","source","lift","ExpandOperator","subscriber","subscribe","ExpandSubscriber","destination","index","active","hasCompleted","buffer","value","closed","_complete","next","result","subscribeToProjection","state","add","schedule","dispatch","e","error","push","complete","unsubscribe","innerValue","_next","length","shift","arg"],"mappings":"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","sourcesContent":["import { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function expand(project, concurrent = Number.POSITIVE_INFINITY, scheduler) {\n    concurrent = (concurrent || 0) < 1 ? Number.POSITIVE_INFINITY : concurrent;\n    return (source) => source.lift(new ExpandOperator(project, concurrent, scheduler));\n}\nexport class ExpandOperator {\n    constructor(project, concurrent, scheduler) {\n        this.project = project;\n        this.concurrent = concurrent;\n        this.scheduler = scheduler;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new ExpandSubscriber(subscriber, this.project, this.concurrent, this.scheduler));\n    }\n}\nexport class ExpandSubscriber extends SimpleOuterSubscriber {\n    constructor(destination, project, concurrent, scheduler) {\n        super(destination);\n        this.project = project;\n        this.concurrent = concurrent;\n        this.scheduler = scheduler;\n        this.index = 0;\n        this.active = 0;\n        this.hasCompleted = false;\n        if (concurrent < Number.POSITIVE_INFINITY) {\n            this.buffer = [];\n        }\n    }\n    static dispatch(arg) {\n        const { subscriber, result, value, index } = arg;\n        subscriber.subscribeToProjection(result, value, index);\n    }\n    _next(value) {\n        const destination = this.destination;\n        if (destination.closed) {\n            this._complete();\n            return;\n        }\n        const index = this.index++;\n        if (this.active < this.concurrent) {\n            destination.next(value);\n            try {\n                const { project } = this;\n                const result = project(value, index);\n                if (!this.scheduler) {\n                    this.subscribeToProjection(result, value, index);\n                }\n                else {\n                    const state = { subscriber: this, result, value, index };\n                    const destination = this.destination;\n                    destination.add(this.scheduler.schedule(ExpandSubscriber.dispatch, 0, state));\n                }\n            }\n            catch (e) {\n                destination.error(e);\n            }\n        }\n        else {\n            this.buffer.push(value);\n        }\n    }\n    subscribeToProjection(result, value, index) {\n        this.active++;\n        const destination = this.destination;\n        destination.add(innerSubscribe(result, new SimpleInnerSubscriber(this)));\n    }\n    _complete() {\n        this.hasCompleted = true;\n        if (this.hasCompleted && this.active === 0) {\n            this.destination.complete();\n        }\n        this.unsubscribe();\n    }\n    notifyNext(innerValue) {\n        this._next(innerValue);\n    }\n    notifyComplete() {\n        const buffer = this.buffer;\n        this.active--;\n        if (buffer && buffer.length > 0) {\n            this._next(buffer.shift());\n        }\n        if (this.hasCompleted && this.active === 0) {\n            this.destination.complete();\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}