<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at
      http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<div class="m-2">
    <form [formGroup]="tokenGenFrom">
        <fieldset>
            <div class="fields">
                <h3>Token Generation</h3>
                @if (tssStatusMessageLevel === 'info') {
                <label style="color: green;">{{tssStatusMessage}}</label>
                }
                @if (tssStatusMessageLevel === 'warning') {
                <label style="color: chocolate;">{{tssStatusMessage}}</label>
                }
                @if (tssStatusMessageLevel === 'error') {
                <label style="color: red;">{{tssStatusMessage}}</label>
                }
                <label class="icon-label"><mat-icon class="reduce-icon-size">info</mat-icon> Token Generation enables
                    integration and API invocations by using the
                    token as an authorization bearer token. Copy the JWT token from the resulting text area and protect
                    it
                    securely from others as this token represents your identity and is active until expired.</label>
                <label class="icon-label"><mat-icon class="reduce-icon-size">info</mat-icon> Configured maximum
                    lifetime: {{tssStatus.maximumLifetimeText}} @if ('Unlimited lifetime' ===
                    tssStatus.maximumLifetimeText) {
                    <mat-icon class="reduce-icon-size">priority_high</mat-icon>
                    }</label>
                @if (tssStatus.lifespanInputEnabled) {
                <div>
                    <mat-form-field class="pe-1" style="width: 6%">
                        <mat-label>Lifetime Days</mat-label>
                        <input matInput type="number" formControlName="lifespanDays" type="number" step="1" min="0"
                            max="3650" value="0">
                    </mat-form-field>
                    <mat-form-field class="pe-1" style="width: 6%">
                        <mat-label>Hours</mat-label>
                        <input matInput type="number" formControlName="lifespanHours" type="number" step="1" min="0"
                            max="23" value="1">
                    </mat-form-field>
                    <mat-form-field style="width: 6%">
                        <mat-label>Minutes</mat-label>
                        <input matInput type="number" formControlName="lifespanMins" type="number" step="1" min="0"
                            max="59" value="0">
                    </mat-form-field>
                    @if (lifespanDays.invalid || lifespanHours.invalid || lifespanMins.invalid ||
                    tokenGenFrom.errors?.allZero) {
                    <label class="icon-label" style="color: red;"><mat-icon
                            class="reduce-icon-size">warning</mat-icon>Invalid
                        lifetime!</label>
                    }
                </div>
                }
                <mat-form-field style="width: 18%;">
                    <mat-label class="icon-label"><mat-icon>mode_comment</mat-icon> Comment</mat-label>
                    <input matInput placeholder="Comment" (keydown.enter)="generateToken()" formControlName="comment">
                </mat-form-field>
                @if (comment.invalid) {
                <label class="icon-label" style="color: red;"><mat-icon
                        class="reduce-icon-size">warning</mat-icon>Invalid comment!</label>
                }

                @if (tssStatus.impersonationEnabled) {
                <div>
                    <mat-form-field style="width: 18%;">
                        <mat-label class="icon-label"><mat-icon>person</mat-icon> Generating token for
                            (impersonation):</mat-label>
                        <input matInput formControlName="impersonation">
                    </mat-form-field>
                    @if (impersonation.invalid) {
                    <label class="icon-label" style="color: red;"><i class="icon-warning"></i>Invalid doAs!</label>
                    }
                </div>
                }
            </div>

            @if (requestErrorMessage) {
            <span class="help-inline" style="color: red;"><span class="errorMsg">{{requestErrorMessage}}</span>
                <mat-icon class="reduce-icon-size" style="color: #ae2817;">warning</mat-icon>
            </span>
            }

            <div>
                <button mat-stroked-button (click)="generateToken()"
                    [disabled]="!tssStatus.tokenManagementEnabled || !tssStatus.allowedTssForTokengen || !tokenGenFrom.valid"
                    color="success">
                    Generate Token
                </button>
            </div>
        </fieldset>
    </form>
</div>
<hr>
<div style="margin-left: 1.75%; margin-right: 1.75%; margin-top: 10px">
    @if (hasResult) {
    <span style="color:black; margin-left: 1.75%; margin-right: 1.75%;">
        <label class="icon-label" (click)="copyTextToClipboard('accessToken')"><mat-icon
                class="reduce-icon-size">content_copy</mat-icon> JWT Token:</label>
        <div class="tokenResultDisplay">
            <span id="accessToken" style="word-wrap: break-word">{{tokenResultData.accessToken}}</span>
        </div>
        <label class="icon-label" (click)="copyTextToClipboard('accessPasscode')"><mat-icon
                class="reduce-icon-size">content_copy</mat-icon> Passcode Token:</label>
        @if (tokenResultData.accessPasscode) {
        <div class="tokenResultDisplay">
            <span id="accessPasscode">{{tokenResultData.accessPasscode}}</span>
        </div>
        }
        <label class="icon-label"><mat-icon class="reduce-icon-size">info</mat-icon> Expiration:</label>
        <div class="tokenResultDisplay">
            <span>{{tokenResultData.expiry}}</span>
        </div>
        <label class="icon-label"><mat-icon class="reduce-icon-size">info</mat-icon> User:</label>
        <div class="tokenResultDisplay">
            <span>{{tokenResultData.user}}</span>
        </div>
        <label class="icon-label" (click)="copyTextToClipboard('target_url')"><mat-icon
                class="reduce-icon-size">content_copy</mat-icon> Target Base URL:</label>
        <div class="tokenResultDisplay">
            <span id="target_url">{{tokenResultData.targetURL}}</span>
        </div>
        <label class="icon-label"><mat-icon class="reduce-icon-size">link</mat-icon> Homepage:</label>
        <div class="tokenResultDisplay">
            <a [href]="tokenResultData.homepageURL">Homepage URL</a>
        </div>
    </span>
    }
</div>